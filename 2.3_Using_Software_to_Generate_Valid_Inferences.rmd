# Accounting for the Sampling Design

The Ethiopia Socioeconomic Survey (ESS4) is part of the Living Standards Measurement Study (LSMS), an initiative by the World Bank in collaboration with the Central Statistical Agency of Ethiopia (CSA). Its objective is to provide high-quality data for the analysis of poverty, food security, agricultural development, and other key socioeconomic aspects.

The ESS4 is part of a series of longitudinal surveys initiated in 2011 under the name Ethiopia Rural Socioeconomic Survey (ERSS). In its first two rounds, the survey only covered rural areas and small towns, but starting from the second wave (ESS2, 2013/2014), the coverage was expanded to all urban areas, ensuring nationally representative estimates. The ESS1, ESS2, and ESS3 waves constitute Panel I, while ESS4 initiates a new panel, serving as the baseline for future surveys.

The survey provides information on household structure, employment, income, consumption, education, health, access to infrastructure, and characteristics of the agricultural sector. One of its key features is the combination of household survey data with administrative records and remote sensing technologies, such as satellite imagery, to improve the accuracy of economic and social indicator estimates.

## Data Source {-}

The ESS4 was implemented by the CSA of Ethiopia, in collaboration with the World Bank and other international organizations. Data collection was conducted through direct interviews with selected households, using electronic devices through Computer-Assisted Personal Interviewing (CAPI). The database includes detailed information on:

-   Household structure and sociodemographic characteristics (age, gender, education, health).

-   Living conditions and economic well-being (income, consumption, access to services).

-   Housing characteristics (construction materials, access to drinking water, sanitation, and electricity).

-   Food security and agricultural production (crops, livestock, access to markets).

-   Access to financing and land tenure.

-   Mobility and migration (internal displacement and job seeking).

The ESS4 not only allows for the generation of descriptive statistics on the Ethiopian population but also facilitates longitudinal studies to assess changes in living conditions over time.

## 2.3 Using Software to Generate Valid Inferences {-}

```{r setup, include = TRUE}
```{r setup, include=FALSE}
# Cleaning R Environment
rm(list = ls())  # Remove all objects from memory
gc()             # Run garbage collection to free memory

# Load Required Libraries
# The following libraries are essential for data processing, survey analysis,
# and visualization:
library(tidyverse)      # Collection of packages for data science
library(survey)         # Tools for complex survey designs and weighted statistics
library(srvyr)         # Tidy interface for survey analysis
library(data.table)     # High-performance data manipulation
library(magrittr)       # Provides pipe operators for cleaner code
library(haven)          # Import SPSS, Stata, and SAS datasets
library(stringr)        # String manipulation functions
library(tidyr)          # Tools for reshaping and tidying data
library(knitr)          # Dynamic report generation
library(kableExtra)     # Enhances table formatting for better readability

# Ensure correct use of dplyr's select function
select <- dplyr::select

# Setting the RAM Memory Limit
memory.limit(250000000)  # Adjust memory allocation to optimize performance
```

### Loading Datasets {-}

The following chunk loads the dataset containing household identification, location, household size, and field staff information.

```{r load-household-data}
dat_Hogar <- read_sav("data/data_ESS4/sect_cover_hh_w4.sav") %>% 
  select(
    household_id,  # Unique Household Identifier
    ea_id,         # Unique Enumeration Area Identifier
    saq14,         # Rural/Urban Classification
    saq02,         # Region-specific Code
    saq01,         # Higher-level Region Code
    pw_w4          # Final adjusted weight for wave 4
  )
```


#### **3.1 Table 1.1A - Enumeration Areas (EAs) and Households by Region and Urban/Rural Classification**

The **Ethiopia Socioeconomic Survey (ESS)** collects data from sampled **Enumeration Areas (EAs)** and **households**, which are categorized by region and rural/urban status.

#### **3.1.1 Counting Enumeration Areas (EAs) by Region and Rural/Urban Classification**

```{r count-eas}
total_ea_id <- dat_Hogar %>% 
  distinct(ea_id, saq14, saq01) %>% 
  mutate(saq14 = as_factor(saq14), saq01 = as_factor(saq01)) %>% 
  group_by(saq01, saq14) %>% 
  tally() %>% 
  pivot_wider(names_from = saq14, values_from = n, values_fill = list(n = 0)) %>% 
  mutate(TOTAL_ea_id = RURAL + URBAN) %>% 
  rename_with(~ paste0(., "_ea_id"), c("RURAL", "URBAN"))

# Display first rows
kable(total_ea_id)
```

#### **3.1.2 Counting Households by Region and Rural/Urban Classification**

```{r count-households}
total_viv <- dat_Hogar %>% 
  distinct(household_id, saq01, saq14) %>% 
  mutate(saq14 = as_factor(saq14), saq01 = as_factor(saq01)) %>% 
  group_by(saq01, saq14) %>% 
  tally() %>% 
  pivot_wider(names_from = saq14, values_from = n, values_fill = list(n = 0)) %>% 
  mutate(TOTAL_HH = RURAL + URBAN) %>% 
  rename_with(~ paste0(., "_HH"), c("RURAL", "URBAN"))

# Display first rows
kable(total_viv)
```

---

#### **3.2 Merging Household and EA Counts**

To obtain a summarized dataset, we merge the **household count** and **Enumeration Area (EA) count** datasets.

```{r merge-data}
temp <- inner_join(total_viv, total_ea_id)

# Summarizing results with an additional row for "Ethiopia"
final_result <- bind_rows(
  temp,
  temp %>% data.frame() %>% summarise_if(is.numeric, sum) %>%
    mutate(saq01 = "Ethiopia")
) %>% 
  select(
    Region = saq01, 
    RURAL_HH, 
    RURAL_AE = RURAL_ea_id,
    URBAN_HH, 
    URBAN_AE =  URBAN_ea_id,
    TOTAL_HH,
    TOTAL_AE = TOTAL_ea_id
  ) %>% 
  data.frame()

# Display final table
kable(final_result, caption = "Sampled EAs and Households by Region and Urban/Rural Classification")
```

---

### 4. **Defining Survey Design for Statistical Inference**

A **survey design object** is created to ensure that all subsequent statistical inferences properly account for the sampling structure.

```{r define-survey-design}
design_sampling <- dat_Hogar %>% 
  mutate(strata = paste0(saq01, "_", saq14)) %>% 
  as_survey_design(
    ids = ea_id,  # Primary Sampling Unit (PSU) Identifier (EA)
    strata = strata,  # Stratification by region (saq01) and urban/rural zone (saq14)
    weights = pw_w4,  # Final adjusted weight
    nest = TRUE
  )

# Display survey design summary
summary(design_sampling)
```
