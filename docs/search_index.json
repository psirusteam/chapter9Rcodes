[["index.html", "CHAPTER 9 - EXAMPLES IN R Abstract", " CHAPTER 9 - EXAMPLES IN R 2025-03-24 Abstract The Ethiopia Socioeconomic Survey (ESS) is a nationally representative study conducted by the Central Statistical Agency of Ethiopia (CSA) in collaboration with the World Bank. Its objective is to collect detailed information on various aspects of Ethiopian households, such as expenditure on goods and services, income, employment, agricultural production, and living conditions. The data collected in the ESS are essential for policy formulation and evaluating the impact of development programs in the country. This survey enables the analysis of consumption patterns and economic inequalities across different regions, distinguishing between urban and rural areas to identify trends and specific population needs. In this study, multiple analyses have been conducted using ESS data, applying data processing and visualization techniques to examine household income and expenditure patterns. Bar charts have been created to illustrate the distribution of spending on non-food items, histograms to assess the density of expenditure across different categories, and scatter plots to explore the relationship between per capita income and expenditure. Additionally, weighted statistical models have been implemented, considering the survey’s sampling structure to ensure representative and robust estimates. These analyses help identify key differences in the economic behavior of Ethiopian households, providing valuable insights for designing interventions and policies aimed at improving the population’s well-being. "],["accounting-for-the-sampling-design.html", "Accounting for the Sampling Design", " Accounting for the Sampling Design The Ethiopia Socioeconomic Survey (ESS4) is part of the Living Standards Measurement Study (LSMS), an initiative by the World Bank in collaboration with the Central Statistical Agency of Ethiopia (CSA). Its objective is to provide high-quality data for the analysis of poverty, food security, agricultural development, and other key socioeconomic aspects. The ESS4 is part of a series of longitudinal surveys initiated in 2011 under the name Ethiopia Rural Socioeconomic Survey (ERSS). In its first two rounds, the survey only covered rural areas and small towns, but starting from the second wave (ESS2, 2013/2014), the coverage was expanded to all urban areas, ensuring nationally representative estimates. The ESS1, ESS2, and ESS3 waves constitute Panel I, while ESS4 initiates a new panel, serving as the baseline for future surveys. The survey provides information on household structure, employment, income, consumption, education, health, access to infrastructure, and characteristics of the agricultural sector. One of its key features is the combination of household survey data with administrative records and remote sensing technologies, such as satellite imagery, to improve the accuracy of economic and social indicator estimates. "],["sample-design-of-the-ess4-20182019.html", "Sample design of the ESS4 2018/2019", " Sample design of the ESS4 2018/2019 The sampling design of ESS4 is based on a two-stage stratified probabilistic sampling, with different strategies for rural and urban areas. In the first stage, enumeration areas (EA) in rural zones were selected using simple random sampling (SRS) from a subsample of the 2018 Large-Scale Agricultural Survey (AgSS). In urban areas, EAs were directly selected from the urban frame using systematic sampling with probability proportional to size (PPS) within each region. This approach ensured a proportional allocation of the sample between urban and rural areas. In the second stage, households within each selected EA were chosen through systematic random sampling. In rural areas, 10 agricultural households were selected from the AgSS sample, along with 2 non-agricultural households, ensuring that the total number of agricultural households remained 10 when fewer than 2 non-agricultural households were available. In urban areas, 15 households per EA were selected, regardless of economic activity. A total of 7,527 households across 565 EAs were initially planned for the survey; however, due to security restrictions, the final number of completed surveys was 6,770 households across 535 EAs. This design ensures representative coverage of socioeconomic conditions in both rural and urban areas. "],["data-source.html", "Data Source", " Data Source The ESS4 was implemented by the CSA of Ethiopia, in collaboration with the World Bank and other international organizations. Data collection was conducted through direct interviews with selected households, using electronic devices through the Computer-Assisted Personal Interviewing (CAPI) methodology. The database includes detailed information on various socioeconomic aspects, such as: Household structure and sociodemographic characteristics (age, gender, education, health). Living conditions and economic well-being (income, consumption, access to services). Housing characteristics (construction materials, access to drinking water, sanitation, and electricity). Food security and agricultural production (crops, livestock, access to markets). Access to financing and land tenure. Mobility and migration (internal displacement and job seeking). For more details on the methodology, sampling design, and data access, you can refer to the official source on the World Bank Microdata Library: ESS4 Survey on Microdata Library - World Bank "],["using-software-to-generate-valid-inferences.html", "2.3 Using Software to Generate Valid Inferences", " 2.3 Using Software to Generate Valid Inferences This set of code blocks prepares the working environment, loads the main household dataset from ESS4, and generates summary tables with the number of households and enumeration areas by region and area type (urban/rural). It then defines the complex survey design, applying the appropriate weights and stratification. Lastly, it validates the structure of the design and presents a summary of its implementation, ensuring that the estimates are representative at both national and regional levels. Prepare the work environment This R code sets up a clean and optimized environment for data analysis before executing any processing. First, it removes all previously loaded objects from memory and performs garbage collection to free up resources, preventing potential conflicts with data from previous sessions. Then, it loads a set of essential libraries for data manipulation and analysis, including packages specialized in survey data, efficient handling of large datasets, and formatting of results. Additionally, it ensures that the select function from dplyr is explicitly used to avoid conflicts with other libraries. Finally, the code adjusts the available RAM memory limit, optimizing performance for large-scale data processing. This setup is particularly useful in survey analysis and statistical studies that involve working with extensive datasets and computationally intensive calculations. #------------------------------------------------------------------------------# # Cleaning R Environment # #------------------------------------------------------------------------------# rm(list = ls()) gc() ## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 542487 29.0 1219720 65.2 660485 35.3 ## Vcells 958338 7.4 8388608 64.0 1770410 13.6 #------------------------------------------------------------------------------# # Libraries # #------------------------------------------------------------------------------# library(tidyverse) library(survey) library(srvyr) library(data.table) library(magrittr) library(haven) library(stringr) library(tidyr) library(knitr) library(kableExtra) # Ensure select function from dplyr is used explicitly select &lt;- dplyr::select #------------------------------------------------------------------------------# # Setting the RAM Memory Limit # #------------------------------------------------------------------------------# memory.limit(250000000) ## [1] Inf Loading Datasets This R code loads and prepares a dataset for the ESS4 survey analysis. It uses the read_sav() function to import a SPSS (.sav) file, ensuring the correct reading of the database. Then, the select() function is applied to extract only the key variables, including unique household and enumeration area identifiers, geographic location information, and stratification into urban and rural areas. Additionally, the final adjusted sampling weight is included, which is essential for obtaining representative estimates. #------------------------------------------------------------------------------# # Loading Datasets # #------------------------------------------------------------------------------# # Household identification; location; household size and field staff identification HH_data &lt;- read_sav(&quot;data/data_ESS4/sect_cover_hh_w4.sav&quot;) %&gt;% select(household_id, # Unique Household Identifier ea_id, # Unique Enumeration Area Identifier saq14, # Area = Rural/Urban saq02, # Zone Code saq01, # Region Code pw_w4 # Final adjusted sampling weight ) This code generates two summary tables that count the enumeration areas and households by region and type of area (urban/rural). First, the ea_counts_by_region table calculates the number of enumeration areas (EA) in each region and zone. To achieve this, unique EAs are identified and grouped by region and area type (urban or rural). The structure is then reorganized using pivot_wider() to display the rural and urban categories as separate columns. Finally, the total number of EAs per region is calculated, and the columns are renamed for better clarity. On the other hand, the hh_counts_by_region table follows a similar process, but instead of counting EAs, it counts the number of households by region and area type. Unique households are extracted along with their respective region and zone, then grouped and counted by category. Subsequently, the data is reorganized using pivot_wider(), allowing urban and rural households to be distinguished in separate columns. Finally, the total number of households per region is calculated, and the columns are renamed to ensure a clear and consistent format. ea_counts_by_region &lt;- HH_data %&gt;% distinct(ea_id, saq14, saq01) %&gt;% mutate(saq14 = as_factor(saq14), saq01 = as_factor(saq01)) %&gt;% group_by(saq01, saq14) %&gt;% tally() %&gt;% pivot_wider( names_from = saq14, values_from = n, values_fill = list(n = 0) ) %&gt;% mutate(ea_counts_by_region = RURAL + URBAN) %&gt;% rename_with( ~ paste0(., &quot;_ea_id&quot;), c(&quot;RURAL&quot;, &quot;URBAN&quot;)) # Count of Households (HH) by region and area (urban/rural) categories hh_counts_by_region &lt;- HH_data %&gt;% distinct(household_id, saq01, saq14) %&gt;% mutate(saq14 = as_factor(saq14), saq01 = as_factor(saq01)) %&gt;% group_by(saq01, saq14) %&gt;% tally() %&gt;% pivot_wider( names_from = saq14, values_from = n, values_fill = list(n = 0) ) %&gt;% mutate(TOTAL_HH = RURAL + URBAN) %&gt;% rename_with( ~ paste0(., &quot;_HH&quot;), c(&quot;RURAL&quot;, &quot;URBAN&quot;)) # Merging both datasets on saq01 temp &lt;- inner_join(hh_counts_by_region, ea_counts_by_region) This R code generates a final summary of the survey results, including an additional row with the total consolidated for “ETHIOPIA”. To achieve this, it combines the regional data stored in temp with a new row representing the sum of all regions. This aggregation is performed using summarise_if(is.numeric, sum), ensuring that all numeric variables are correctly summed, while the region column (saq01) is manually assigned as “ETHIOPIA”. Next, the dataset is reorganized using select(), where key variables are renamed for better clarity. The resulting table includes the number of rural and urban households, the number of enumeration areas for each type of zone, and the total counts of households and enumeration areas. Finally, it is converted into a data frame to facilitate manipulation and visualization. This process provides a structured view of the distribution of the population and enumeration areas, allowing for both regional analysis and a consolidated national overview. # Summarizing the results including an additional row for &quot;ETHIOPIA&quot; survey_counts &lt;- bind_rows( temp, temp %&gt;% data.frame() %&gt;% summarise_if(is.numeric, sum) %&gt;% mutate(saq01 = &quot;ETHIOPIA&quot;) ) %&gt;% select( Region = saq01, RURAL_HH, RURAL_AE = RURAL_ea_id, URBAN_HH, URBAN_AE = URBAN_ea_id, TOTAL_HH, TOTAL_AE = ea_counts_by_region ) %&gt;% data.frame() # Display final result data.frame(survey_counts) The table summarizes the distribution of households and enumeration areas (EA) by region in Ethiopia, distinguishing between rural and urban areas. Nationally, the sample includes 6,770 households and 535 EAs, with a relatively balanced distribution between urban and rural areas. The regions with the highest number of rural households are Amhara (479), Oromia (453), and SNNP (422), while Addis Ababa is entirely urban (778 households and 52 EAs). In terms of EAs, Amhara and Oromia lead in rural areas, while Addis Ababa and Dire Dawa have higher urban concentrations. Region RURAL_HH RURAL_AE URBAN_HH URBAN_AE TOTAL_HH TOTAL_AE TIGRAY 393 35 283 19 676 54 AFAR 299 28 225 15 524 43 AMHARA 479 43 271 18 750 61 OROMIA 453 43 300 20 753 63 SOMALI 355 35 255 17 610 52 BENISHANGUL GUMUZ 169 16 195 13 364 29 SNNP 422 40 269 18 691 58 GAMBELA 195 19 300 20 495 39 HARAR 190 18 360 24 550 42 ADDIS ABABA 0 0 778 52 778 52 DIRE DAWA 160 14 419 28 579 42 ETHIOPIA 3115 291 3655 244 6770 535 Defining the survey design This code defines the survey design for the ESS4 survey using the survey package in R, ensuring that the analysis accurately reflects the sample structure. First, a new variable strata is created by combining the region (saq01) with the urban/rural classification (saq14), allowing for proper stratification of the design. Then, the dataset HH_data is converted into a survey design (as_survey_design()), specifying: - ids = ea_id: Identifier of the primary sampling unit (enumeration area, EA). - strata = strata: Stratification by region and urban/rural area. - weights = pw_w4: Use of the adjusted sampling weight to obtain representative estimates. - nest = TRUE: Indicates that sampling units are nested within strata. #------------------------------------------------------------------------------# # Defining the survey design #------------------------------------------------------------------------------# ESS4_design &lt;- HH_data %&gt;% mutate(strata = paste0(saq01, &quot;_&quot;, saq14)) %&gt;% as_survey_design( ids = ea_id, # Primary sampling unit identifier (EA) strata = strata, # Stratification by region (saq01) and urban/rural zone (saq14) weights = pw_w4, # Final adjusted weight nest = TRUE ) Additionally, the option survey.lonely.psu = \"fail\" is set, causing the code to produce an error if a stratum has only a single, non-certainty primary sampling unit (PSU), ensuring a correctly specified survey design. Finally, summary(ESS4_design) is used to display a summary of the design, allowing verification of its structure before analysis. # Makes it an error to have a stratum with a single, non-certainty PSU options(survey.lonely.psu = &quot;fail&quot;) summary(ESS4_design) ## Stratified 1 - level Cluster Sampling design (with replacement) ## With (535) clusters. ## Called via srvyr ## Probabilities: ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 3.932e-05 1.997e-04 7.680e-04 2.814e-03 4.164e-03 1.317e-01 ## Stratum Sizes: ## 1_1 1_2 12_1 12_2 13_1 13_2 14_2 15_1 15_2 2_1 2_2 3_1 3_2 4_1 4_2 ## obs 393 283 195 300 190 360 778 160 419 299 225 479 271 453 300 ## design.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 43 20 ## actual.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 43 20 ## 5_1 5_2 6_1 6_2 7_1 7_2 ## obs 355 255 169 195 422 269 ## design.PSU 35 17 16 13 40 18 ## actual.PSU 35 17 16 13 40 18 ## Data variables: ## [1] &quot;household_id&quot; &quot;ea_id&quot; &quot;saq14&quot; &quot;saq02&quot; &quot;saq01&quot; ## [6] &quot;pw_w4&quot; &quot;strata&quot; The results confirm that the ESS4 survey design was correctly implemented using a stratified cluster sampling approach (PSU) with replacement. The stratification combines the region and the urban/rural classification, ensuring representativeness at both levels. The sample includes 535 clusters (PSU), and the number of primary sampling units in each stratum matches the planned design, indicating a consistent execution. The selection probabilities vary by region and area type, reflecting a sampling design adjusted to the population’s characteristics. Overall, these results validate the sampling structure and ensure that the derived estimates are representative at both the national and regional levels, accounting for geographic distribution and urban-rural stratification. "],["frequencies-and-proportions.html", "3.1 Frequencies and Proportions", " 3.1 Frequencies and Proportions This code block sets up the working environment for a new section of the analysis, focused on calculating frequencies and proportions based on the ESS4 survey design. Although this structure was defined earlier in the manual, it is repeated here to ensure that execution remains self-contained, reproducible, and free from interference from previous sections. Prepare the work environment This code block marks the beginning of a new working session, following the same methodological line established earlier. Its main purpose is to prepare a clean, efficient, and fully loaded environment to continue with the processing and analysis of the survey data. By resetting the R environment, reloading the necessary libraries, and adjusting the memory settings, this ensures that any subsequent analysis is carried out in a controlled manner, free from interference by previous objects or configurations. This approach is especially useful when working with modular scripts, such as in a manual, as it allows each section to be executed independently, ensuring reproducibility and consistency throughout the entire workflow. #------------------------------------------------------------------------------# # Cleaning R Environment # #------------------------------------------------------------------------------# rm(list = ls()) gc() ## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 554800 29.7 1241915 66.4 686454 36.7 ## Vcells 982594 7.5 8388608 64.0 1876235 14.4 #------------------------------------------------------------------------------# # Libraries # #------------------------------------------------------------------------------# library(tidyverse) library(survey) library(srvyr) library(data.table) library(magrittr) library(haven) library(stringr) library(tidyr) library(knitr) library(kableExtra) # Ensure select function from dplyr is used explicitly select &lt;- dplyr::select #------------------------------------------------------------------------------# # Setting the RAM Memory Limit # #------------------------------------------------------------------------------# memory.limit(250000000) ## [1] Inf This block continues the analysis, focusing on the processing of household consumption expenditure and participation in various items over the past 12 months. The dataset from section 7b of the questionnaire is loaded, and two variables are created: one for the amount spent (expenditure) and a binary indicator (yes_no) that reflects whether or not the household incurred that expense. Next, the survey design is defined using the same structure as before: strata are created by combining region and urban/rural classification, primary sampling units (ea_id) are specified, and the adjusted sampling weights (pw_w4) are applied. The summary of the design allows for validation before proceeding with the analysis. #------------------------------------------------------------------------------# # Loading Datasets # #------------------------------------------------------------------------------# HH_data &lt;- read_sav(&quot;data/data_ESS4/sect7b_hh_w4_v2.sav&quot;) # Processing expenditure and response indicators HH_data &lt;- HH_data %&gt;% group_by(item = item_cd_12months) %&gt;% mutate( expenditure = ifelse(s7q03 == 2, 0, s7q04), yes_no = ifelse(s7q03 == 2, 0, 1) ) # Defining the survey design ESS4_design &lt;- HH_data %&gt;% mutate(strata = paste0(saq01, &quot;_&quot;, saq14)) %&gt;% as_survey_design( ids = ea_id, # Primary sampling unit identifier (EA) strata = strata, # Stratification by region (saq01) and urban/rural zone (saq14) weights = pw_w4, # Final adjusted weight nest = TRUE ) # Makes it an error to have a stratum with a single, non-certainty PSU options(survey.lonely.psu = &quot;fail&quot;) summary(ESS4_design) ## Stratified 1 - level Cluster Sampling design (with replacement) ## With (535) clusters. ## Called via srvyr ## Probabilities: ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 3.932e-05 1.997e-04 7.680e-04 2.814e-03 4.164e-03 1.317e-01 ## Stratum Sizes: ## 1_1 1_2 12_1 12_2 13_1 13_2 14_2 15_1 15_2 2_1 2_2 3_1 3_2 ## obs 4323 3113 2145 3300 2090 3960 8558 1760 4609 3289 2475 5269 2981 ## design.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 ## actual.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 ## 4_1 4_2 5_1 5_2 6_1 6_2 7_1 7_2 ## obs 4983 3300 3905 2805 1859 2145 4642 2959 ## design.PSU 43 20 35 17 16 13 40 18 ## actual.PSU 43 20 35 17 16 13 40 18 ## Data variables: ## [1] &quot;household_id&quot; &quot;item_cd_12months&quot; &quot;ea_id&quot; &quot;saq14&quot; ## [5] &quot;pw_w4&quot; &quot;saq01&quot; &quot;saq02&quot; &quot;saq03&quot; ## [9] &quot;saq04&quot; &quot;saq05&quot; &quot;saq06&quot; &quot;saq07&quot; ## [13] &quot;saq08&quot; &quot;s7q03&quot; &quot;s7q04&quot; &quot;item&quot; ## [17] &quot;expenditure&quot; &quot;yes_no&quot; &quot;strata&quot; Estimating totals and proportions This block calculates key indicators related to household spending on nonfood items and services, grouping the data by item type (item_cd_12months). Based on the defined survey design, two main estimates are produced: N_hat: the estimated total number of households reporting expenditures on each item, along with its standard error and coefficient of variation. P_hat: the estimated proportion of households who reported spending, including its standard error, coefficient of variation, and a 95% confidence interval. These estimates provide insight into both the magnitude and coverage of consumption across different categories of goods and services at the national level. #------------------------------------------------------------------------------# # TABLE 7.3 # Spending on Nonfood Items and Services # # ESS4 Sampled EAs and Households by Region and by Urban and Rural # Ethiopia Socioeconomic Survey (ESS) 2018/19 # SURVEY REPORT # Central Statistics Agency of Ethiopia | World Bank #------------------------------------------------------------------------------# tab_01 &lt;- ESS4_design %&gt;% group_by(item = item_cd_12months) %&gt;% summarise( N_hat = survey_total(yes_no, na.rm = TRUE, vartype = c(&quot;se&quot;, &quot;cv&quot;)), # Absolute size P_hat = survey_mean(yes_no, na.rm = TRUE, vartype = c(&quot;se&quot;, &quot;cv&quot;, &quot;ci&quot;)) # Proportions ) Formatting and presenting results In this block, the previously computed results are transformed into a reader-friendly table. Item codes are converted into factors, and all estimates are rounded for clarity, including: - The total number of households (N_hat), - The proportion of households (P_hat), - Standard errors, coefficients of variation, and confidence intervals. This step facilitates interpretation and prepares the table for inclusion in technical reports or analytical documents, such as the official ESS4 survey report. The resulting table provides a summary of nonfood items and services purchased by Ethiopian households over the past 12 months, with estimates based on the ESS4 survey design. It includes key precision measures such as the coefficient of variation (*_cv), standard error (*_se), and the 95% confidence interval (*_low, *_upp). tab_01 %&gt;% transmute( item = as_factor(item), N_hat = round(N_hat), N_hat_cv = round(N_hat_cv * 100, 2), P_hat = round(P_hat * 100, 2), P_hat_cv = round(P_hat_cv * 100, 2), P_hat_se = round(P_hat_se * 100, 2), P_hat_low = round(P_hat_low * 100, 2), P_hat_upp = round(P_hat_upp * 100, 2) ) %&gt;% data.frame() item N_hat N_hat_cv P_hat P_hat_cv P_hat_se P_hat_low P_hat_upp Clothes/shoes/fabric for MEN (18 years and older) 11641511 3.13 58.01 3.04 1.77 54.54 61.48 Clothes/shoes/fabric for WOMEN (18 years and older) 12665176 3.03 63.11 2.90 1.83 59.51 66.71 Clothes/shoes/fabric for BOYS (less than 18 years) 10538136 2.46 52.51 2.21 1.16 50.23 54.79 Clothes/shoes/fabric for GIRLS (less than 18 years) 10366155 2.52 51.66 2.30 1.19 49.33 53.99 Kitchen equipment (cooking pots, etc.) 3427502 8.63 17.08 8.58 1.46 14.20 19.96 Linens (sheets, towels,blankets) 5673849 5.83 28.27 5.63 1.59 25.15 31.40 Furniture 1583809 10.57 7.89 10.46 0.83 6.27 9.51 Lamp/torch/solare power 5607831 6.12 27.94 6.02 1.68 24.64 31.25 Ceremonial expenses 12305188 3.76 61.32 3.54 2.17 57.05 65.59 Contributions to informal social security institutions (inc. IDDIR, mahiber..) 8985343 5.06 44.78 4.96 2.22 40.41 49.14 Donations to religious institutions (Incl. churches and mosques..) 8174601 5.16 40.74 5.10 2.08 36.66 44.81 "],["totals-means-and-ratios.html", "3.2 Totals, means and ratios", " 3.2 Totals, means and ratios This section of the manual focuses on the calculation of totals, means, and ratios using data from the ESS4 survey. It begins by setting up the work environment and loading data on nonfood item expenditures. It then estimates the total and average household expenditure for each item type, along with precision measures. Next, it calculates the share of each item’s expenditure relative to total household spending, at both national and regional levels, and presents the results in a comparative table. The section concludes with a focused analysis of educational expenditure as a share of total consumption, using an aggregated dataset. All results are formatted for clear interpretation and regional comparison. Prepare the work environment This block resets the working environment and loads the necessary packages to continue with data processing and survey analysis in a new section. This structure ensures that each module of the analysis can be executed independently, promoting reproducibility and avoiding conflicts with previous sessions. #------------------------------------------------------------------------------# # Cleaning R Environment # #------------------------------------------------------------------------------# rm(list = ls()) gc() ## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 542333 29.0 1219280 65.2 660485 35.3 ## Vcells 955470 7.3 8388608 64.0 1770406 13.6 #------------------------------------------------------------------------------# # Libraries # #------------------------------------------------------------------------------# library(tidyverse) library(survey) library(srvyr) library(data.table) library(magrittr) library(haven) library(stringr) library(tidyr) library(knitr) library(kableExtra) # Ensure select function from dplyr is used explicitly select &lt;- dplyr::select #------------------------------------------------------------------------------# # Setting the RAM Memory Limit # #------------------------------------------------------------------------------# memory.limit(250000000) ## [1] Inf This block loads data from section 7b of the household questionnaire, related to expenditures on nonfood items, and calculates the total expenditure per household. It then defines the survey design using the same stratification structure and primary sampling units as in previous sections, in order to apply the adjusted weights in the analysis. This step is essential to produce representative estimates of expenditure and its distribution across households. #------------------------------------------------------------------------------# # Loading Datasets # #------------------------------------------------------------------------------# HH_data &lt;- read_sav(&quot;data/data_ESS4/sect7b_hh_w4_v2.sav&quot;) #------------------------------------------------------------------------------# # Calculating Ratio of Expenditures # #------------------------------------------------------------------------------# # Processing data HH_data &lt;- HH_data %&gt;% mutate(expenditure = ifelse(s7q03 == 2, 0, s7q04)) %&gt;% group_by(household_id) %&gt;% mutate(total_expenditure = sum(expenditure, na.rm = TRUE)) # Defining the survey design ESS4_design &lt;- HH_data %&gt;% mutate(strata = paste0(saq01, &quot;_&quot;, saq14)) %&gt;% as_survey_design( ids = ea_id, # Primary sampling unit identifier (EA) strata = strata, # Stratification by region (saq01) and urban/rural zone (saq14) weights = pw_w4, # Final adjusted weight nest = TRUE ) options(survey.lonely.psu = &quot;fail&quot;) summary(ESS4_design) ## Stratified 1 - level Cluster Sampling design (with replacement) ## With (535) clusters. ## Called via srvyr ## Probabilities: ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 3.932e-05 1.997e-04 7.680e-04 2.814e-03 4.164e-03 1.317e-01 ## Stratum Sizes: ## 1_1 1_2 12_1 12_2 13_1 13_2 14_2 15_1 15_2 2_1 2_2 3_1 3_2 ## obs 4323 3113 2145 3300 2090 3960 8558 1760 4609 3289 2475 5269 2981 ## design.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 ## actual.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 ## 4_1 4_2 5_1 5_2 6_1 6_2 7_1 7_2 ## obs 4983 3300 3905 2805 1859 2145 4642 2959 ## design.PSU 43 20 35 17 16 13 40 18 ## actual.PSU 43 20 35 17 16 13 40 18 ## Data variables: ## [1] &quot;household_id&quot; &quot;item_cd_12months&quot; &quot;ea_id&quot; ## [4] &quot;saq14&quot; &quot;pw_w4&quot; &quot;saq01&quot; ## [7] &quot;saq02&quot; &quot;saq03&quot; &quot;saq04&quot; ## [10] &quot;saq05&quot; &quot;saq06&quot; &quot;saq07&quot; ## [13] &quot;saq08&quot; &quot;s7q03&quot; &quot;s7q04&quot; ## [16] &quot;expenditure&quot; &quot;total_expenditure&quot; &quot;strata&quot; Estimation of totals and means This block estimates the total expenditure and the average expenditure per household on nonfood items, disaggregated by item type. Using the previously defined survey design, the estimates are calculated along with their corresponding precision measures: standard error and coefficient of variation. The results are then rounded and displayed in a readable table to facilitate analysis and interpretation. #------------------------------------------------------------------------------# # Estimation of totals and means #------------------------------------------------------------------------------# tab_02 &lt;- ESS4_design %&gt;% group_by(item = item_cd_12months) %&gt;% summarise( T_hat = survey_total(expenditure, na.rm = TRUE, vartype = c(&quot;se&quot;, &quot;cv&quot;)), M_hat = survey_mean(expenditure, na.rm = TRUE, vartype = c(&quot;se&quot;, &quot;cv&quot;)) ) tab_02 %&gt;% transmute( item = as_factor(item), T_hat = round(T_hat), T_hat_cv = round(T_hat_cv * 100, 2), M_hat = round(M_hat), M_hat_cv = round(M_hat_cv * 100, 2) ) %&gt;% data.frame() item T_hat T_hat_cv M_hat M_hat_cv Clothes/shoes/fabric for MEN (18 years and older) 14831623627 5.16 739 5.10 Clothes/shoes/fabric for WOMEN (18 years and older) 12372041190 4.61 617 4.58 Clothes/shoes/fabric for BOYS (less than 18 years) 8240485360 4.18 411 3.96 Clothes/shoes/fabric for GIRLS (less than 18 years) 7093344006 4.18 353 4.05 Kitchen equipment (cooking pots, etc.) 1546185290 9.68 77 9.64 Linens (sheets, towels,blankets) 3948547743 7.58 197 7.53 Furniture 3204286706 14.43 160 14.38 Lamp/torch/solare power 1364016013 12.61 68 12.58 Ceremonial expenses 26850995607 6.39 1338 6.23 Contributions to informal social security institutions (inc. IDDIR, mahiber..) 2939856749 9.22 146 9.20 Donations to religious institutions (Incl. churches and mosques..) 3238210354 10.25 161 9.89 Estimation of Ratio This block estimates the share of expenditure on each nonfood item relative to total household spending, both at the national level and by region, using the survey_ratio() function. Two tables are generated: one for Ethiopia as a whole and another disaggregated by region, both including standard errors and coefficients of variation. #------------------------------------------------------------------------------# # Estimation of Ratio # #------------------------------------------------------------------------------# tab_03_R1_total &lt;- ESS4_design %&gt;% group_by(item = item_cd_12months) %&gt;% summarise(R_hat = survey_ratio( expenditure, total_expenditure, na.rm = TRUE, vartype = c(&quot;se&quot;, &quot;cv&quot;) )) %&gt;% mutate(Region = &quot;ETHIOPIA&quot;) tab_03_R1_region &lt;- ESS4_design %&gt;% group_by(item = item_cd_12months, Region = as_factor(saq01)) %&gt;% summarise(R_hat = survey_ratio( expenditure, total_expenditure, na.rm = TRUE, vartype = c(&quot;se&quot;, &quot;cv&quot;) )) # Combining results tab_03_R1 &lt;- bind_rows(tab_03_R1_total, tab_03_R1_region) In this block, the results are formatted as percentages and paired with their standard errors in parentheses. The table is then reshaped into wide format, displaying regions as columns to facilitate comparison. # Formatting output tab_03_R1 &lt;- tab_03_R1 %&gt;% transmute( Region, item = as_factor(item), R_hat = round(R_hat * 100, 2), R_hat = paste0(R_hat, &quot; (&quot;, round(R_hat_se * 100, 2), &quot;)&quot;) ) %&gt;% pivot_wider( names_from = Region, values_from = R_hat, values_fill = list(n = 0) ) tab_03_R1 item ETHIOPIA TIGRAY AFAR AMHARA OROMIA SOMALI BENISHANGUL GUMUZ SNNP GAMBELA HARAR ADDIS ABABA DIRE DAWA Clothes/shoes/fabric for MEN (18 years and older) 17.32 (0.64) 16.41 (1.99) 21.76 (2.07) 15.57 (1.03) 19.75 (1.47) 13.9 (1.07) 18.5 (2.17) 15.1 (1.31) 18.94 (1.76) 16.84 (1.81) 19.82 (1.77) 15.91 (1.55) Clothes/shoes/fabric for WOMEN (18 years and older) 14.45 (0.53) 17.76 (1.18) 21.91 (1.81) 13.04 (0.93) 14.98 (1.28) 13.11 (0.9) 16.16 (1.37) 11.55 (1.02) 17.47 (1.75) 17.3 (1.23) 18.33 (1.02) 14.94 (1.31) Clothes/shoes/fabric for BOYS (less than 18 years) 9.62 (0.38) 8.87 (0.86) 14.85 (1.08) 7.61 (0.67) 11.38 (0.95) 16.68 (1.27) 9.3 (1.31) 8.89 (0.73) 10.07 (1.21) 12.08 (1.48) 7.16 (0.65) 11.56 (1.2) Clothes/shoes/fabric for GIRLS (less than 18 years) 8.28 (0.34) 7.98 (0.8) 10.75 (0.79) 6.17 (0.51) 9.13 (0.87) 14.69 (0.94) 8.06 (1) 8.97 (0.7) 8.58 (1.12) 11.5 (1.49) 6.59 (0.53) 8.85 (1.15) Kitchen equipment (cooking pots, etc.) 1.81 (0.16) 1.69 (0.58) 1.21 (0.47) 2.01 (0.38) 1.52 (0.28) 1.27 (0.21) 2.07 (0.49) 1.91 (0.31) 3.87 (0.87) 2.29 (0.45) 2.32 (0.46) 0.95 (0.26) Linens (sheets, towels,blankets) 4.61 (0.3) 4.22 (0.63) 3.31 (0.59) 4 (0.7) 4.94 (0.6) 5.22 (0.8) 4.18 (0.69) 5.52 (0.72) 6.52 (0.97) 4.55 (0.9) 3.69 (0.64) 3.09 (0.55) Furniture 3.74 (0.49) 7.05 (2.19) 1.11 (0.45) 2.61 (0.77) 3.83 (1.19) 1.33 (0.69) 7.69 (2.72) 2.58 (0.66) 4.17 (1.4) 3.61 (1.23) 6.42 (1.2) 7.33 (3.4) Lamp/torch/solare power 1.59 (0.19) 1.35 (0.25) 1.01 (0.23) 2.12 (0.46) 1.82 (0.44) 2.88 (0.53) 2.17 (0.55) 1.11 (0.19) 3.14 (0.81) 0.64 (0.14) 0.08 (0.03) 1.38 (0.59) Ceremonial expenses 31.36 (1.26) 31.17 (3.75) 19.33 (2.73) 40.7 (2.62) 23.65 (2.67) 29.45 (2.79) 25.88 (3.11) 34.18 (2.85) 21.42 (2.97) 26.15 (3.35) 30.46 (2.42) 32.45 (2.74) Contributions to informal social security institutions (inc. IDDIR, mahiber..) 3.43 (0.27) 1.23 (0.36) 1.25 (0.31) 2.53 (0.46) 4.8 (0.65) 0.42 (0.14) 1.16 (0.32) 4.39 (0.52) 1.65 (0.42) 1.81 (0.29) 3.41 (0.52) 1.93 (0.36) Donations to religious institutions (Incl. churches and mosques..) 3.78 (0.35) 2.26 (0.53) 3.51 (2.18) 3.64 (0.62) 4.22 (0.84) 1.06 (0.43) 4.81 (1.13) 5.81 (0.84) 4.17 (0.71) 3.22 (0.45) 1.71 (0.32) 1.6 (0.74) Estimating the Ratio of Educational Expenditure This block begins the analysis of educational expenditure by loading an aggregated consumption dataset. The survey design is then defined using the same stratification structure and adjusted weights applied in previous sections. This step is essential to ensure that estimates of educational spending are properly representative of the survey’s sample design. #------------------------------------------------------------------------------# # Estimating the Ratio of Educational Expenditure # #------------------------------------------------------------------------------# HH_data &lt;- read_sav(&quot;data/data_ESS4/cons_agg_w4.sav&quot;) # Defining the survey design ESS4_design &lt;- HH_data %&gt;% mutate(strata = paste0(saq01, &quot;_&quot;, saq14)) %&gt;% as_survey_design( ids = ea_id, # Primary sampling unit identifier (EA) strata = strata, # Stratification by region (saq01) and urban/rural zone (saq14) weights = pw_w4, # Final adjusted weight nest = TRUE ) Estimation of the ratio This block estimates the share of educational expenditure relative to total household consumption, both at the national level and by region. The survey_ratio() function is used to calculate the ratio between annual educational consumption (educ_cons_ann) and total annual consumption (total_cons_ann), including precision measures such as standard error and coefficient of variation. National and regional results are combined into a single table for further analysis and visualization. #------------------------------------------------------------------------------# # Estimation of the ratio. # #------------------------------------------------------------------------------# tab_03_R2_total &lt;- ESS4_design %&gt;% summarise(R_hat = survey_ratio( educ_cons_ann, total_cons_ann, na.rm = TRUE, vartype = c(&quot;se&quot;, &quot;cv&quot;) )) %&gt;% mutate(Region = &quot;ETHIOPIA&quot;) tab_03_R2_region &lt;- ESS4_design %&gt;% group_by(Region = as_factor(saq01)) %&gt;% summarise(R_hat = survey_ratio( educ_cons_ann, total_cons_ann, na.rm = TRUE, vartype = c(&quot;se&quot;, &quot;cv&quot;) )) # Combining results tab_03_R2 &lt;- bind_rows(tab_03_R2_region, tab_03_R2_total) This final block formats the results of the educational expenditure as a share of total household consumption, expressing them as percentages. Both the estimated ratio (R_hat) and its standard error (R_hat_se) are included, allowing for easy interpretation and comparison across regions and at the national level. # Formatting and displaying results tab_03_R2 %&gt;% transmute(Region, R_hat = round(R_hat * 100, 2), R_hat_se = round(R_hat_se * 100, 2)) Region R_hat R_hat_se TIGRAY 2.51 0.43 AFAR 0.88 0.14 AMHARA 1.41 0.19 OROMIA 1.56 0.17 SOMALI 1.73 0.27 BENISHANGUL GUMUZ 2.44 0.60 SNNP 2.13 0.38 GAMBELA 2.09 0.32 HARAR 2.85 0.36 ADDIS ABABA 8.87 1.38 DIRE DAWA 3.36 0.37 ETHIOPIA 2.35 0.17 "],["correlations.html", "3.3 Correlations", " 3.3 Correlations This section estimates correlations between educational expenditure and other types of household spending using the complex survey design from the ESS4 dataset. It explores the relationship between educational spending and two key components of consumption: utilities and food away from home. The estimates are presented at three levels: 1. National, capturing the overall association. 2. By area type (urban/rural), to explore territorial differences. 3. By region, providing a detailed subnational analysis. The results include correlation coefficients along with their standard errors, allowing for the assessment of both the strength and precision of the associations observed. Prepare the work environment This block sets up the working environment, loads an aggregated individual-level consumption dataset, and defines the survey design for analysis. The data is stratified by region and area type (urban/rural), and both the primary sampling units (ea_id) and adjusted weights (pw_w4) are specified. Applying this structure ensures that all estimates reflect the representativeness of the survey design. Finally, a summary of the design is displayed as a preliminary validation step. #------------------------------------------------------------------------------# # Cleaning R Environment # #------------------------------------------------------------------------------# rm(list = ls()) gc() ## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 542546 29.0 1219888 65.2 660485 35.3 ## Vcells 955799 7.3 8388608 64.0 1770406 13.6 #------------------------------------------------------------------------------# # Libraries # #------------------------------------------------------------------------------# library(tidyverse) library(survey) library(srvyr) library(data.table) library(magrittr) library(haven) library(stringr) library(tidyr) library(knitr) library(kableExtra) # Ensure select function from dplyr is used explicitly select &lt;- dplyr::select #------------------------------------------------------------------------------# # Loading Datasets # #------------------------------------------------------------------------------# IND_data &lt;- read_sav(&quot;data/data_ESS4/cons_agg_w4.sav&quot;) %&gt;% mutate(strata = paste0(saq01, &quot;_&quot;, saq14)) #------------------------------------------------------------------------------# # Defining Survey Design # #------------------------------------------------------------------------------# ESS4_design &lt;- IND_data %&gt;% as_survey_design( ids = ea_id, # Primary sampling unit identifier (EA) strata = strata, # Stratification by region (saq01) and urban/rural zone (saq14) weights = pw_w4, # Final adjusted weight nest = TRUE ) options(survey.lonely.psu = &quot;fail&quot;) summary(ESS4_design) ## Stratified 1 - level Cluster Sampling design (with replacement) ## With (535) clusters. ## Called via srvyr ## Probabilities: ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 3.932e-05 1.997e-04 7.680e-04 2.814e-03 4.164e-03 1.317e-01 ## Stratum Sizes: ## 1_1 1_2 12_1 12_2 13_1 13_2 14_2 15_1 15_2 2_1 2_2 3_1 3_2 4_1 4_2 ## obs 393 283 195 300 190 360 778 160 419 299 225 479 271 453 300 ## design.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 43 20 ## actual.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 43 20 ## 5_1 5_2 6_1 6_2 7_1 7_2 ## obs 355 255 169 195 422 269 ## design.PSU 35 17 16 13 40 18 ## actual.PSU 35 17 16 13 40 18 ## Data variables: ## [1] &quot;household_id&quot; &quot;ea_id&quot; &quot;saq01&quot; ## [4] &quot;saq14&quot; &quot;pw_w4&quot; &quot;adulteq&quot; ## [7] &quot;hh_size&quot; &quot;food_cons_ann&quot; &quot;nonfood_cons_ann&quot; ## [10] &quot;educ_cons_ann&quot; &quot;fafh_cons_ann&quot; &quot;utilities_cons_ann&quot; ## [13] &quot;total_cons_ann&quot; &quot;nom_foodcons_aeq&quot; &quot;nom_nonfoodcons_aeq&quot; ## [16] &quot;nom_educcons_aeq&quot; &quot;nom_utilities_aeq&quot; &quot;nom_totcons_aeq&quot; ## [19] &quot;spat_totcons_aeq&quot; &quot;cons_quint&quot; &quot;strata&quot; Estimating Correlations This block calculates the overall correlation between annual educational expenditure and two types of spending: utilities and food away from home. The estimates account for the complex survey design. #------------------------------------------------------------------------------# # Estimating Correlations # #------------------------------------------------------------------------------# # Overall correlation ESS4_design %&gt;% summarise( corr1 = survey_corr(educ_cons_ann, utilities_cons_ann), corr2 = survey_corr(educ_cons_ann, fafh_cons_ann) ) The table shows the national-level estimated correlations between annual educational expenditure and two types of spending: corr1: correlation between educational spending and utility expenses, estimated at 0.19, indicating a moderate positive association. corr2: correlation between educational spending and food away from home, estimated at 0.06, suggesting a weak association. Both estimates include their respective standard errors, allowing for an assessment of precision within the context of the complex survey design. corr1 corr1_se corr2 corr2_se 0.1906679 0.0313768 0.0551461 0.0250799 This block estimates the correlation by area type (urban or rural), allowing us to identify differences in spending patterns depending on geographic setting. # Correlation grouped by urban/rural area ESS4_design %&gt;% group_by(area = as_factor(saq14)) %&gt;% summarise( corr1 = survey_corr(educ_cons_ann, utilities_cons_ann), corr2 = survey_corr(educ_cons_ann, fafh_cons_ann) ) The table shows the correlations between educational expenditure and other types of spending, broken down by area of residence: In rural areas, the correlation between educational spending and utilities (corr1) is moderate (0.19) but has higher uncertainty (standard error = 0.073). The correlation with food away from home (corr2) is nearly zero (0.009). In urban areas, the correlation with utilities remains positive (0.16) and is more precise (standard error = 0.025). The correlation with food away from home is slightly higher (0.039) than in rural areas but still weak. These results suggest that the link between educational and utility spending is consistent across areas, while the relationship with food away from home is weak—particularly in rural settings. area corr1 corr1_se corr2 corr2_se RURAL 0.1910101 0.0729421 0.0091824 0.0257959 URBAN 0.1582441 0.0248202 0.0391755 0.0221427 This block estimates the correlation between expenditure variables by region, providing a more detailed view of consumption relationships at the subnational level. # Correlation grouped by region ESS4_design %&gt;% group_by(Region = as_factor(saq01)) %&gt;% summarise( corr1 = survey_corr(educ_cons_ann, utilities_cons_ann), corr2 = survey_corr(educ_cons_ann, fafh_cons_ann) ) The table displays regional correlations between educational expenditure and two types of spending: utilities (corr1) and food away from home (corr2), along with their standard errors. In most regions, the correlation between education and utilities is positive and moderate, with the highest values in Dire Dawa (0.33), Somali (0.31), Amhara (0.24), and Harar (0.23). This suggests that households investing more in education also tend to spend more on utilities in those areas. The correlation with food away from home is weaker and more variable. Notably, Tigray (0.25) shows a stronger positive association, while Benishangul Gumuz (-0.07) and Dire Dawa (-0.04) show negative correlations, possibly reflecting different spending trade-offs or priorities. The standard errors indicate precision: Addis Ababa has the most precise estimates, while regions like SNNP and Tigray show greater uncertainty. Region corr1 corr1_se corr2 corr2_se TIGRAY 0.1909944 0.0809238 0.2539895 0.0621995 AFAR 0.1700086 0.0586904 -0.0021256 0.0574260 AMHARA 0.2370307 0.0570303 0.0401066 0.0363661 OROMIA 0.2096871 0.0381022 -0.0103300 0.0372057 SOMALI 0.3050576 0.0560321 0.0536496 0.0709755 BENISHANGUL GUMUZ 0.0079110 0.0272672 -0.0658016 0.0232147 SNNP 0.2022214 0.0712977 0.0467115 0.0269180 GAMBELA 0.1174653 0.0444969 0.0224387 0.0497909 HARAR 0.2334025 0.0598253 0.0476901 0.0362023 ADDIS ABABA 0.1816015 0.0214595 0.0152325 0.0212303 DIRE DAWA 0.3336417 0.0726053 -0.0382218 0.0236171 "],["percentiles-and-inequality-measures.html", "3.4 Percentiles and inequality measures", " 3.4 Percentiles and inequality measures This section estimates key inequality and income access indicators among Ethiopian households using ESS4 survey data. It begins by processing non-labor income sources, calculating the proportion of households that received each source, along with the mean and median income values. Then, it computes the Gini coefficient based on per capita expenditure, taking into account the complex survey design. A per-person expenditure variable is constructed, the survey design is defined using convey, and the Gini is calculated both at the national and regional levels. The final results help characterize income inequality in Ethiopia and highlight regional disparities, providing essential evidence to inform equity-oriented public policy. Prepare the work environment This block initiates the analysis of income by source using data from Section 13 of the ESS4 household questionnaire. It begins by cleaning the environment, loading the required libraries, and importing the relevant dataset. Then, income variables are processed: - income is created to reflect the reported value or zero if no income was received. - A binary indicator yes_no is defined to flag participation in each income source. Next, the survey design is defined using stratification by region and area type (urban/rural), primary sampling unit identifiers, and adjusted weights. This setup ensures that all income estimates are representative. A summary of the design is provided as a consistency check before further analysis. #------------------------------------------------------------------------------# # Cleaning R Environment # #------------------------------------------------------------------------------# rm(list = ls()) gc() ## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 542662 29.0 1220220 65.2 660485 35.3 ## Vcells 956517 7.3 8388608 64.0 1770410 13.6 #------------------------------------------------------------------------------# # Libraries # #------------------------------------------------------------------------------# library(tidyverse) library(survey) library(srvyr) library(data.table) library(magrittr) library(haven) library(stringr) library(tidyr) library(knitr) library(kableExtra) library(convey) # Ensure select function from dplyr is used explicitly select &lt;- dplyr::select #------------------------------------------------------------------------------# # Setting the RAM Memory Limit # #------------------------------------------------------------------------------# memory.limit(250000000) ## [1] Inf #------------------------------------------------------------------------------# # Loading Datasets # #------------------------------------------------------------------------------# HH_data &lt;- read_sav(&quot;data/data_ESS4/sect13_hh_w4_v2.sav&quot;) #------------------------------------------------------------------------------# # Processing Income Data # #------------------------------------------------------------------------------# HH_data &lt;- HH_data %&gt;% group_by(item = source_cd) %&gt;% mutate(income = ifelse(s13q01 == 2, 0, s13q02), yes_no = ifelse(s13q01 == 2, 0, 1)) #------------------------------------------------------------------------------# # Defining Survey Design # #------------------------------------------------------------------------------# ESS4_design &lt;- HH_data %&gt;% mutate(strata = paste0(saq01, &quot;_&quot;, saq14)) %&gt;% as_survey_design( ids = ea_id, # Primary sampling unit identifier (EA) strata = strata, # Stratification by region (saq01) and urban/rural zone (saq14) weights = pw_w4, # Final adjusted weight nest = TRUE ) options(survey.lonely.psu = &quot;fail&quot;) summary(ESS4_design) ## Stratified 1 - level Cluster Sampling design (with replacement) ## With (535) clusters. ## Called via srvyr ## Probabilities: ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 3.932e-05 1.997e-04 7.680e-04 2.814e-03 4.164e-03 1.317e-01 ## Stratum Sizes: ## 1_1 1_2 12_1 12_2 13_1 13_2 14_2 15_1 15_2 2_1 2_2 3_1 3_2 ## obs 5502 3962 2730 4200 2660 5040 10892 2240 5866 4186 3150 6706 3794 ## design.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 ## actual.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 ## 4_1 4_2 5_1 5_2 6_1 6_2 7_1 7_2 ## obs 6342 4200 4970 3570 2366 2730 5908 3766 ## design.PSU 43 20 35 17 16 13 40 18 ## actual.PSU 43 20 35 17 16 13 40 18 ## Data variables: ## [1] &quot;household_id&quot; &quot;source_cd&quot; &quot;ea_id&quot; &quot;saq14&quot; &quot;pw_w4&quot; ## [6] &quot;saq01&quot; &quot;saq02&quot; &quot;saq03&quot; &quot;saq04&quot; &quot;saq05&quot; ## [11] &quot;saq06&quot; &quot;saq07&quot; &quot;saq08&quot; &quot;s13q01&quot; &quot;s13q02&quot; ## [16] &quot;s13q03_1&quot; &quot;s13q03_2&quot; &quot;s13q04a&quot; &quot;s13q04b&quot; &quot;s13q04c&quot; ## [21] &quot;s13q05&quot; &quot;item&quot; &quot;income&quot; &quot;yes_no&quot; &quot;strata&quot; Estimating the Mean and Median of Total Other Income This block estimates key indicators to construct Table 5.3 of the ESS4 report, which focuses on non-labor income sources received over the last 12 months, broken down by type. First, it calculates the mean (M_hat) and median (Md_hat) income for each source (item), including only households that reported receiving income from that source. Then, it estimates the proportion of households (P_hat) that reported receiving each income type, based on the binary variable yes_no. Finally, both results are merged into a single table that summarizes the coverage and estimated amounts of income by source across the country. #------------------------------------------------------------------------------# # Estimation of Income Statistics - TABLE 5.3 # # Other Income by Source in the Last 12 Months and Median Income by Source, # Ethiopia 2018/19 #------------------------------------------------------------------------------# # ESS4 Sampled EAs and Households by Region and by Urban and Rural # Ethiopia Socioeconomic Survey (ESS) 2018/19 # SURVEY REPORT # Central Statistics Agency of Ethiopia | World Bank #------------------------------------------------------------------------------# # Estimating the Mean and Median of Total Other Income tab_06 &lt;- ESS4_design %&gt;% group_by(item) %&gt;% filter(s13q01 == 1) %&gt;% summarise( M_hat = survey_mean(income, na.rm = TRUE, vartype = c(&quot;se&quot;, &quot;cv&quot;)), Md_hat = survey_median(income, na.rm = TRUE, vartype = c(&quot;se&quot;, &quot;cv&quot;)) ) # Estimating proportion of HH that received other income sources tab_06_P &lt;- ESS4_design %&gt;% group_by(item) %&gt;% summarise(P_hat = survey_mean(yes_no, na.rm = TRUE, vartype = c(&quot;se&quot;, &quot;cv&quot;))) # Merging income and proportion tables tab_06 &lt;- inner_join(tab_06, tab_06_P) This block produces the final formatted output for the estimates of non-labor income sources, resulting in a clear and concise table. For each income source, it presents the proportion of households that reported receiving it (P_hat), along with its standard error and coefficient of variation, allowing for the evaluation of both coverage and estimate precision. It also includes the median income (Md_hat) among recipients, with corresponding measures of uncertainty. All values are rounded to enhance readability and interpretation, making the resulting table suitable for technical reports or comparative analyses. # Formatting and displaying results tab_06 %&gt;% transmute( item = as_factor(item), P_hat = round(P_hat * 100, 2), P_hat_cv = round(P_hat_cv * 100, 2), P_hat_se = round(P_hat_se * 100, 2), Md_hat = round(Md_hat), Md_hat_se = round(Md_hat_se), Md_hat_cv = round(Md_hat_cv * 100, 2) ) The table summarizes the estimated non-labor income sources for the Ethiopian population. For each income type, it shows the proportion of recipient households (P_hat), along with its standard error and coefficient of variation, allowing assessment of both coverage and estimate precision. It also reports the median income (Md_hat) among those who received the income, including precision measures. The most common sources include cash transfers from individuals (10.3%) and food transfers (5.1%), while pensions and land rental show relatively high median values. In contrast, less common sources such as inheritance, asset sales, or rental of tools display higher uncertainty or lack sufficient data for reliable precision estimates. item P_hat P_hat_cv P_hat_se Md_hat Md_hat_se Md_hat_cv Cash Transfer/Gifts from Individuals 10.33 7.10 0.73 4000 508 12.71 Food Transfers/Gifts from Individuals 5.15 10.44 0.54 500 203 40.53 Non-food In-kind Transfers/Gifts form Individuals 2.49 15.47 0.39 800 252 31.48 Savings, Interest or Other Investment Income 0.23 48.34 0.11 520 NaN NaN Pension Income 1.42 13.46 0.19 7000 1206 17.23 Income from Shop/Store Rental/Car, truck, other vehicle rental 2.47 13.24 0.33 6000 1161 19.35 Income from Land Rental 4.02 12.73 0.51 4000 266 6.66 Income from Renting Agricultural Tools 0.17 50.31 0.08 2500 NaN NaN Income from Renting Transport Animals 0.66 25.60 0.17 600 1039 173.14 Income from Real Estate Sales 0.16 53.31 0.08 2880 NaN NaN Income from household Non-Agricultural Asset Sales 0.98 24.17 0.24 3500 1759 50.27 Income from household Agricultural/Fishing Asset Sales 7.90 16.88 1.33 6500 882 13.57 Income from sales of other Fixed Assets (Sale of b/ss enterprises or stocks/shares 0.89 33.56 0.30 4600 5830 126.74 Inheritance/Lottery/Gambling Winnings 0.18 47.66 0.09 12000 NaN NaN The Gini Coefficient. This block prepares the data required to calculate the Gini coefficient based on per capita expenditure. It begins by loading the nonfood expenditure dataset and computing total household expenditure, considering only items that were actually purchased. This is then merged with the household cover data to retrieve household size (saq09). Using this merged dataset, per capita expenditure is calculated by dividing total expenditure by the number of household members. Lastly, summary statistics of the resulting variable are generated as a preliminary step before inequality estimation. #------------------------------------------------------------------------------# # Loading Datasets # #------------------------------------------------------------------------------# EXP_data &lt;- read_sav(&quot;data/data_ESS4/sect7b_hh_w4_v2.sav&quot;) %&gt;% mutate(expenditure = ifelse(s7q03 == 2, 0, s7q04)) %&gt;% group_by(household_id) %&gt;% summarise(total_expenditure = sum(expenditure, na.rm = TRUE)) HH_data &lt;- read_sav(&quot;data/data_ESS4/sect_cover_hh_w4.sav&quot;) #------------------------------------------------------------------------------# # Processing Per Capita Expenditure # #------------------------------------------------------------------------------# # Merging household data with expenditure data HH_data &lt;- HH_data %&gt;% inner_join(EXP_data) HH_data &lt;- HH_data %&gt;% mutate(percapita_expenditure = total_expenditure / saq09) # Summary statistics summary(HH_data$percapita_expenditure) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 0.0 335.7 800.0 1470.2 1706.7 58378.0 This block defines the survey design based on the previously processed household data and prepares it for inequality analysis using the convey package. A stratification variable is created by combining the region (saq01) and the urban/rural classification (saq14), while the primary sampling units (ea_id) and final adjusted weights (pw_w4) are specified. The design is then prepared using convey_prep(), which is essential for computing measures such as the Gini coefficient under a complex survey framework. Finally, a summary of the prepared design is displayed to verify its structure before proceeding with the analysis. #------------------------------------------------------------------------------# # Defining the Survey Design # #------------------------------------------------------------------------------# ESS4_design &lt;- HH_data %&gt;% mutate(strata = paste0(saq01, &quot;_&quot;, saq14)) %&gt;% as_survey_design( ids = ea_id, # Primary sampling unit identifier (EA) strata = strata, # Stratification by region (saq01) and urban/rural zone (saq14) weights = pw_w4, # Final adjusted weight nest = TRUE ) design_gini &lt;- convey_prep(ESS4_design) options(survey.lonely.psu = &quot;fail&quot;) summary(design_gini) ## Stratified 1 - level Cluster Sampling design (with replacement) ## With (535) clusters. ## Called via srvyr ## Probabilities: ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 3.932e-05 1.997e-04 7.680e-04 2.814e-03 4.164e-03 1.317e-01 ## Stratum Sizes: ## 1_1 1_2 12_1 12_2 13_1 13_2 14_2 15_1 15_2 2_1 2_2 3_1 3_2 4_1 4_2 ## obs 393 283 195 300 190 360 778 160 419 299 225 479 271 453 300 ## design.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 43 20 ## actual.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 43 20 ## 5_1 5_2 6_1 6_2 7_1 7_2 ## obs 355 255 169 195 422 269 ## design.PSU 35 17 16 13 40 18 ## actual.PSU 35 17 16 13 40 18 ## Data variables: ## [1] &quot;household_id&quot; &quot;ea_id&quot; &quot;saq14&quot; ## [4] &quot;pw_w4&quot; &quot;saq01&quot; &quot;saq02&quot; ## [7] &quot;saq03&quot; &quot;saq04&quot; &quot;saq05&quot; ## [10] &quot;saq06&quot; &quot;saq07&quot; &quot;saq08&quot; ## [13] &quot;saq09&quot; &quot;saq11&quot; &quot;saq12&quot; ## [16] &quot;saq13&quot; &quot;saq17&quot; &quot;saq18&quot; ## [19] &quot;InterviewStart&quot; &quot;saq21&quot; &quot;total_expenditure&quot; ## [22] &quot;percapita_expenditure&quot; &quot;strata&quot; This block computes the Gini coefficient of per capita expenditure using the complex survey design. It first estimates the national value, then uses map_df() to calculate regional Gini coefficients (saq01). Each estimate includes its standard error, allowing assessment of inequality both nationally and by region. #------------------------------------------------------------------------------# # Computing Gini Coefficient based on expenditure # #------------------------------------------------------------------------------# # National Gini coefficient tab_07_tot &lt;- svygini(~ percapita_expenditure, design = design_gini) %&gt;% as.data.frame() %&gt;% mutate(Region = &quot;ETHIOPIA&quot;) %&gt;% rename(SE = percapita_expenditure) # Regional Gini coefficient tab_07_region &lt;- map_df( unique(HH_data$saq01), ~ svygini( ~ percapita_expenditure, design = design_gini %&gt;% filter(saq01 == .x)) %&gt;% as.data.frame() %&gt;% mutate(Region = as_factor(.x))) %&gt;% rename(SE = percapita_expenditure) This block merges the national and regional results into a single table, with Gini coefficients and their standard errors rounded and expressed as percentages. # Combining results tab_07 &lt;- bind_rows(tab_07_region, tab_07_tot) %&gt;% transmute(Region, gini = round(gini * 100, 2), SE = round(SE * 100, 2),) rownames(tab_07) &lt;- NULL tab_07 The table shows the Gini coefficient values for per capita expenditure in Ethiopia, both nationally and by region. At the national level, the Gini is estimated at 58.68%, indicating a high degree of inequality in expenditure distribution. Regionally, the highest inequality levels are found in Benishangul Gumuz (67.41%), Gambela (61.40%), and SNNP (61.19%). Conversely, Somali (49.28%), Addis Ababa (53.46%), and Dire Dawa (53.81%) show relatively lower inequality. These findings highlight significant regional disparities, which are crucial for informing targeted policy interventions. Region gini SE TIGRAY 60.19 2.61 AFAR 54.22 4.04 AMHARA 56.16 2.08 OROMIA 57.28 2.33 SOMALI 49.28 2.88 BENISHANGUL GUMUZ 67.41 3.44 SNNP 61.19 2.83 GAMBELA 61.40 3.10 HARAR 58.90 2.94 ADDIS ABABA 53.46 1.84 DIRE DAWA 53.81 2.40 ETHIOPIA 58.68 1.12 "],["cross-tabulations.html", "4.2 Cross-tabulations", " 4.2 Cross-tabulations Together, this module provides a comprehensive and well-structured estimation of the religious distribution among the Ethiopian population aged 10 and above, using ESS4 microdata and accounting for the complex survey design. Through proportions and totals, it reveals patterns of religious affiliation at the national level, by region, and by area type (urban/rural). The resulting tables allow for accurate interpretation and clear comparisons across geographic and social groups. Prepare the work environment This block sets up the working environment to analyze data from Section 1 of the ESS4 household questionnaire. After clearing the memory and loading the required libraries, the corresponding dataset is imported, and the survey design is defined. It includes stratification by region and area type (urban/rural), identification of primary sampling units (ea_id), and use of adjusted sampling weights (pw_w4). This design ensures that subsequent analyses correctly reflect the complex survey structure and produce representative estimates. A summary of the design is printed at the end to verify its proper specification. #------------------------------------------------------------------------------# # Cleaning R Environment # #------------------------------------------------------------------------------# rm(list = ls()) gc() ## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 542659 29.0 1220211 65.2 660485 35.3 ## Vcells 957073 7.4 8388608 64.0 1770406 13.6 #------------------------------------------------------------------------------# # Libraries # #------------------------------------------------------------------------------# library(tidyverse) library(survey) library(srvyr) library(data.table) library(magrittr) library(haven) library(stringr) library(tidyr) library(knitr) library(kableExtra) library(convey) # Ensure select function from dplyr is used explicitly select &lt;- dplyr::select #------------------------------------------------------------------------------# # Setting the RAM Memory Limit # #------------------------------------------------------------------------------# memory.limit(250000000) ## [1] Inf #------------------------------------------------------------------------------# # Loading Datasets # #------------------------------------------------------------------------------# options(survey.lonely.psu = &quot;fail&quot;) HH_data &lt;- read_sav(&quot;data/data_ESS4/sect1_hh_w4.sav&quot;) #------------------------------------------------------------------------------# # Defining Survey Design # #------------------------------------------------------------------------------# ESS4_design &lt;- HH_data %&gt;% mutate(strata = paste0(saq01, &quot;_&quot;, saq14)) %&gt;% as_survey_design( ids = ea_id, # Primary sampling unit identifier (EA) strata = strata, # Stratification by region (saq01) and urban/rural zone (saq14) weights = pw_w4, # Final adjusted weight nest = TRUE ) options(survey.lonely.psu = &quot;fail&quot;) summary(ESS4_design) ## Stratified 1 - level Cluster Sampling design (with replacement) ## With (535) clusters. ## Called via srvyr ## Probabilities: ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 3.932e-05 1.647e-04 7.503e-04 2.545e-03 3.839e-03 1.317e-01 ## Stratum Sizes: ## 1_1 1_2 12_1 12_2 13_1 13_2 14_2 15_1 15_2 2_1 2_2 3_1 3_2 4_1 ## obs 1822 944 956 1304 896 1207 2956 797 1524 1552 750 2173 835 2384 ## design.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 43 ## actual.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 43 ## 4_2 5_1 5_2 6_1 6_2 7_1 7_2 ## obs 1099 2089 1406 807 704 2226 1072 ## design.PSU 20 35 17 16 13 40 18 ## actual.PSU 20 35 17 16 13 40 18 ## Data variables: ## [1] &quot;household_id&quot; &quot;individual_id&quot; &quot;ea_id&quot; &quot;saq14&quot; ## [5] &quot;pw_w4&quot; &quot;saq01&quot; &quot;saq02&quot; &quot;saq03&quot; ## [9] &quot;saq04&quot; &quot;saq05&quot; &quot;saq06&quot; &quot;saq07&quot; ## [13] &quot;saq08&quot; &quot;s1q00&quot; &quot;s1q01&quot; &quot;s1q02&quot; ## [17] &quot;s1q03a&quot; &quot;s1q03b&quot; &quot;s1q04&quot; &quot;s1q05&quot; ## [21] &quot;s1q06&quot; &quot;s1q23&quot; &quot;s1q23_os&quot; &quot;s1q07&quot; ## [25] &quot;s1q08&quot; &quot;s1q08_os&quot; &quot;s1q09&quot; &quot;s1q10&quot; ## [29] &quot;s1q11&quot; &quot;s1q12&quot; &quot;s1q13&quot; &quot;s1q14&quot; ## [33] &quot;s1q15&quot; &quot;s1q16&quot; &quot;s1q17&quot; &quot;s1q18&quot; ## [37] &quot;s1q19&quot; &quot;s1q20&quot; &quot;s1q21&quot; &quot;s1q21_os&quot; ## [41] &quot;s1q22&quot; &quot;s1q22_os&quot; &quot;strata&quot; Processing Variables for Analysis This block processes the variables needed for the analysis. It converts sex (s1q02) and religion (s1q08) into factors and recodes less frequent religion categories—such as “PEGAN”, “TRADITIONAL”, “WAKEFETA”, “OTHER (SPECIFY)”, and missing values—into a consolidated \"OTHER\" group. Additionally, the dataset is filtered to retain only individuals aged 10 years or older (s1q03a &gt;= 10), ensuring that the analysis focuses on the population most likely to engage in social or economic activities. #------------------------------------------------------------------------------# # Processing Variables for Analysis # #------------------------------------------------------------------------------# ESS4_design &lt;- ESS4_design %&gt;% mutate( sexo = as_factor(s1q02), religion = as_factor(s1q08), religion = case_when( religion %in% c(&quot;6. PEGAN&quot;, &quot;5. TRADITIONAL&quot;, &quot;8. OTHER (SPECIFY)&quot;, &quot;7. WAKEFETA&quot;) | is.na(religion) ~ &quot;OTHER&quot;, TRUE ~ religion ) ) %&gt;% filter(s1q03a &gt;= 10) Estimating Proportions and Totals by Religion This block estimates the religious distribution of the population aged 10 and above, computing proportions and total population counts using the complex survey design. First, estimates are calculated by administrative region (saq01) and religion. Then, a national-level estimate is generated by grouping the entire sample under “ETHIOPIA”. Lastly, the same indicators are estimated by urban and rural areas (saq14). For each region or area and religion combination, the output includes the estimated proportion (P_hat) and the population total (T_hat), along with standard errors and coefficients of variation—ensuring both accurate interpretation and comparative analysis. #------------------------------------------------------------------------------# # Estimating Proportions and Totals by Religion # #------------------------------------------------------------------------------# # Estimates by region tab_01_region &lt;- ESS4_design %&gt;% group_by(Region = as_factor(saq01), religion) %&gt;% summarise(P_hat = survey_mean(vartype = c(&quot;se&quot;, &quot;cv&quot;)), T_hat = survey_total(vartype = c(&quot;se&quot;, &quot;cv&quot;))) # National estimates tab_01_tot &lt;- ESS4_design %&gt;% group_by(Region = &quot;ETHIOPIA&quot;, religion) %&gt;% summarise(P_hat = survey_mean(vartype = c(&quot;se&quot;, &quot;cv&quot;)), T_hat = survey_total(vartype = c(&quot;se&quot;, &quot;cv&quot;))) # Estimates by urban/rural zones tab_01_zone &lt;- ESS4_design %&gt;% group_by(Region = as_factor(saq14), religion) %&gt;% summarise(P_hat = survey_mean(vartype = c(&quot;se&quot;, &quot;cv&quot;)), T_hat = survey_total(vartype = c(&quot;se&quot;, &quot;cv&quot;))) Formatting and Displaying Cross-tabulation Tables This block displays the final table of religious affiliation proportions, reorganized for clarity and comparative analysis. It combines estimates by region, area (urban/rural), and national level, then selects the estimated proportion (P_hat) and religion, and reshapes the data into wide format. The proportions are expressed as percentages rounded to one decimal place. Finally, the table is filtered to show only the most relevant religious groups: Orthodox, Catholic, Protestant, Muslim, and Other. This simplified presentation is ideal for technical reports or visualizations that require a clear view of differences across geographic or social groups. #------------------------------------------------------------------------------# # Formatting and Displaying Cross-tabulation Tables # #------------------------------------------------------------------------------# # Proportions table temp1 &lt;- bind_rows(tab_01_region, tab_01_zone, tab_01_tot) %&gt;% select(P_hat, religion) %&gt;% mutate(P_hat = round(P_hat * 100, 1)) %&gt;% pivot_wider( names_from = religion, values_from = P_hat, values_fill = list(P_hat = 0) ) temp1 %&gt;% select( Region, Orthodox = &quot;1. ORTHODOX&quot;, Catholic = &quot;2. CATHOLIC&quot;, Protestant = &quot;3. PROTESTANT&quot;, Muslim = &quot;4. MUSLEM&quot;, Other = OTHER ) Region Orthodox Catholic Protestant Muslim Other TIGRAY 92.2 2.1 0.0 1.7 4.0 AFAR 8.2 0.0 2.2 83.5 6.1 AMHARA 71.7 0.2 0.5 21.1 6.6 OROMIA 27.8 1.8 24.9 36.6 9.0 SOMALI 0.6 0.0 0.1 98.0 1.3 BENISHANGUL GUMUZ 36.3 0.7 11.2 45.5 6.3 SNNP 21.6 0.7 54.6 15.7 7.4 GAMBELA 29.8 6.1 51.1 8.8 4.2 HARAR 23.6 0.2 3.8 69.4 3.0 ADDIS ABABA 74.9 0.5 9.3 15.0 0.3 DIRE DAWA 35.5 0.5 4.2 58.1 1.8 RURAL 37.2 1.3 20.9 31.4 9.2 URBAN 54.5 0.4 21.8 22.9 0.4 ETHIOPIA 41.9 1.0 21.2 29.1 6.8 This block generates and formats a table of absolute population sizes by religious affiliation, based on the survey design. Using the combined results by region, area (urban/rural), and national level, it selects the estimated population totals (T_hat) and the religion variable. The values are rounded and reshaped into a wide-format table, with religions as columns. The final table displays only the main categories: Orthodox, Catholic, Protestant, Muslim, and Other. This output provides an estimate of the number of individuals aged 10 and above affiliated with each religion, disaggregated by region or area type. # Absolute Sizes table temp2 &lt;- bind_rows(tab_01_region, tab_01_zone, tab_01_tot) %&gt;% select(T_hat, religion) %&gt;% mutate(T_hat = round(T_hat)) %&gt;% pivot_wider( names_from = religion, values_from = T_hat, values_fill = list(T_hat = 0) ) temp2 %&gt;% select( Region, Orthodox = &quot;1. ORTHODOX&quot;, Catholic = &quot;2. CATHOLIC&quot;, Protestant = &quot;3. PROTESTANT&quot;, Muslim = &quot;4. MUSLEM&quot;, Other = OTHER ) Region Orthodox Catholic Protestant Muslim Other TIGRAY 3918416 90616 0 70593 168421 AFAR 46553 0 12526 475602 34677 AMHARA 11576000 35300 73597 3401683 1057761 OROMIA 6924343 440773 6206179 9142683 2233299 SOMALI 21033 1445 3248 3293124 42153 BENISHANGUL GUMUZ 241389 4544 74695 302755 41819 SNNP 2946567 97681 7461357 2147076 1010342 GAMBELA 84131 17155 144558 24853 11981 HARAR 42907 338 7001 126355 5429 ADDIS ABABA 2337560 14534 290894 469778 9085 DIRE DAWA 108171 1431 12717 177047 5587 RURAL 18316384 629418 10307786 15450070 4551967 URBAN 9930687 74400 3978986 4181478 68588 ETHIOPIA 28247071 703818 14286772 19631549 4620555 "],["testing-for-independence.html", "4.3 Testing for Independence", " 4.3 Testing for Independence This code section performs a comprehensive analysis of educational attainment patterns using survey data. It begins by setting up the R environment and loading necessary packages, then processes parental education variables and geographic classifications. The analysis implements proper survey weighting methodology and generates both descriptive statistics (through cross-tabulations) and inferential tests (chi-square tests of independence) to examine relationships between education levels and residential zones. The workflow includes data cleaning, variable recoding, survey design specification, and statistical testing components. Prepare the work environment This initial code block in chapter 4.3 prepares the working environment to apply independence tests on categorical data from the ESS4 household questionnaire (Section 1). It begins by clearing the R environment to avoid conflicts with previous sessions and loads the required libraries for analyzing complex survey data (survey, srvyr, among others). The select function from dplyr is explicitly set to avoid masking issues, and a high RAM limit is configured to enhance performance for large-scale computations. Finally, the corresponding dataset is imported using read_sav(), enabling efficient and structured handling of SPSS (.sav) files for subsequent analysis. #------------------------------------------------------------------------------# # Cleaning R Environment # #------------------------------------------------------------------------------# rm(list = ls()) gc() ## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 542531 29.0 1219845 65.2 660485 35.3 ## Vcells 956464 7.3 8388608 64.0 1770410 13.6 #------------------------------------------------------------------------------# # Libraries # #------------------------------------------------------------------------------# library(tidyverse) library(survey) library(srvyr) library(data.table) library(magrittr) library(haven) library(stringr) library(tidyr) library(knitr) library(kableExtra) library(convey) # Ensure select function from dplyr is used explicitly select &lt;- dplyr::select #------------------------------------------------------------------------------# # Setting the RAM Memory Limit # #------------------------------------------------------------------------------# memory.limit(250000000) ## [1] Inf #------------------------------------------------------------------------------# # Loading Datasets # #------------------------------------------------------------------------------# HH_data &lt;- read_sav(&quot;data/data_ESS4/sect1_hh_w4.sav&quot;) Processing Education Variables This block processes and recodes the parental education variables into analytical categories. It creates a new variable for the mother’s education level (education_mother) and another for the father’s education level (education_father), grouping the original codes into four levels: “No education”, “Primary”, “Secondary”, and “Above secondary”. The case_when() function is used to classify multiple values into defined ranges or categories of interest, while also handling special codes (e.g., 98 = unknown) and missing values. Additionally, a zone variable is created as a factor, representing the urban/rural classification (saq14), which will be useful for later cross-tabulations by area of residence. #------------------------------------------------------------------------------# # Processing Education Variables # #------------------------------------------------------------------------------# HH_data &lt;- HH_data %&gt;% mutate( education_mother = case_when( s1q20 %in% c(98, 99, 93) ~ &quot;01 No education&quot;, s1q20 %in% c(96, 94) ~ &quot;02 Primary&quot;, s1q20 &gt;= 0 &amp; s1q20 &lt;= 8 ~ &quot;02 Primary&quot;, s1q20 %in% c(9:13, 21:26, 95) ~ &quot;03 Secondary&quot;, is.na(s1q20) ~ NA_character_, TRUE ~ &quot;04 Above secondary&quot; ), education_father = case_when( s1q16 %in% c(98, 99, 93) ~ &quot;01 No education&quot;, s1q16 %in% c(96, 94) ~ &quot;02 Primary&quot;, s1q16 &gt;= 0 &amp; s1q16 &lt;= 8 ~ &quot;02 Primary&quot;, s1q16 %in% c(9:13, 21:26, 95) ~ &quot;03 Secondary&quot;, is.na(s1q16) ~ NA_character_, TRUE ~ &quot;04 Above secondary&quot; ), zone = as_factor(saq14) ) As in previous sections, this block redefines the complex survey design using the dataset with processed education variables. The same stratification structure by region and urban/rural area is retained, and adjusted weights (pw_w4) are applied. This setup is essential to ensure that subsequent analyses, including independence tests, correctly account for the survey design. #------------------------------------------------------------------------------# # Defining the Survey Design # #------------------------------------------------------------------------------# ESS4_design &lt;- HH_data %&gt;% mutate(strata = paste0(saq01, &quot;_&quot;, saq14)) %&gt;% as_survey_design( ids = ea_id, # Primary sampling unit identifier (EA) strata = strata, # Stratification by region (saq01) and urban/rural zone (saq14) weights = pw_w4, # Final adjusted weight nest = TRUE ) options(survey.lonely.psu = &quot;fail&quot;) summary(ESS4_design) ## Stratified 1 - level Cluster Sampling design (with replacement) ## With (535) clusters. ## Called via srvyr ## Probabilities: ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 3.932e-05 1.647e-04 7.503e-04 2.545e-03 3.839e-03 1.317e-01 ## Stratum Sizes: ## 1_1 1_2 12_1 12_2 13_1 13_2 14_2 15_1 15_2 2_1 2_2 3_1 3_2 4_1 ## obs 1822 944 956 1304 896 1207 2956 797 1524 1552 750 2173 835 2384 ## design.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 43 ## actual.PSU 35 19 19 20 18 24 52 14 28 28 15 43 18 43 ## 4_2 5_1 5_2 6_1 6_2 7_1 7_2 ## obs 1099 2089 1406 807 704 2226 1072 ## design.PSU 20 35 17 16 13 40 18 ## actual.PSU 20 35 17 16 13 40 18 ## Data variables: ## [1] &quot;household_id&quot; &quot;individual_id&quot; &quot;ea_id&quot; &quot;saq14&quot; ## [5] &quot;pw_w4&quot; &quot;saq01&quot; &quot;saq02&quot; &quot;saq03&quot; ## [9] &quot;saq04&quot; &quot;saq05&quot; &quot;saq06&quot; &quot;saq07&quot; ## [13] &quot;saq08&quot; &quot;s1q00&quot; &quot;s1q01&quot; &quot;s1q02&quot; ## [17] &quot;s1q03a&quot; &quot;s1q03b&quot; &quot;s1q04&quot; &quot;s1q05&quot; ## [21] &quot;s1q06&quot; &quot;s1q23&quot; &quot;s1q23_os&quot; &quot;s1q07&quot; ## [25] &quot;s1q08&quot; &quot;s1q08_os&quot; &quot;s1q09&quot; &quot;s1q10&quot; ## [29] &quot;s1q11&quot; &quot;s1q12&quot; &quot;s1q13&quot; &quot;s1q14&quot; ## [33] &quot;s1q15&quot; &quot;s1q16&quot; &quot;s1q17&quot; &quot;s1q18&quot; ## [37] &quot;s1q19&quot; &quot;s1q20&quot; &quot;s1q21&quot; &quot;s1q21_os&quot; ## [41] &quot;s1q22&quot; &quot;s1q22_os&quot; &quot;education_mother&quot; &quot;education_father&quot; ## [45] &quot;zone&quot; &quot;strata&quot; This block estimates the educational distribution of biological parents of children and adolescents under 18 years old, based on the complex survey design. It first computes national-level estimates for fathers (education_father) and mothers (education_mother) using proportions (survey_mean). Then, it generates zone-level estimates (urban or rural, saq14) for both parents, grouped by their respective education levels. The results are reshaped into wide-format tables using pivot_wider() to facilitate comparison across zones. #------------------------------------------------------------------------------# # TABLE 2.4 - Education and Occupation of Biological Parents # # Source: Central Statistics Agency of Ethiopia &amp; World Bank (2018/19) # # Ethiopia Socioeconomic Survey (ESS) Survey Report # #------------------------------------------------------------------------------# ## National estimates for father`s education tab_02_tot_father &lt;- ESS4_design %&gt;% filter(s1q03a &lt; 18,!is.na(education_father)) %&gt;% group_by(Education = education_father) %&gt;% summarise(P_father_National = survey_mean(vartype = c(&quot;se&quot;, &quot;cv&quot;))) ## National estimates for mother&#39;s education tab_02_tot_mother &lt;- ESS4_design %&gt;% filter(s1q03a &lt; 18,!is.na(education_mother)) %&gt;% group_by(Education = education_mother) %&gt;% summarise(P_mother_National = survey_mean(vartype = c(&quot;se&quot;, &quot;cv&quot;))) ## Estimates by zone for father tab_02_zone_father &lt;- ESS4_design %&gt;% filter(s1q03a &lt; 18,!is.na(education_father)) %&gt;% group_by(zone, Education = education_father) %&gt;% summarise(P_father = survey_mean(vartype = c(&quot;se&quot;, &quot;cv&quot;))) tab_02_zone_father_P &lt;- tab_02_zone_father %&gt;% transmute(zone, Education , P_father) %&gt;% pivot_wider( names_from = zone , values_from = P_father, values_fill = list(P_father = 0), names_prefix = &quot;P_father&quot; ) ## Estimates by zone for mother tab_02_zone_mother &lt;- ESS4_design %&gt;% filter(s1q03a &lt; 18,!is.na(education_mother)) %&gt;% group_by(zone, Education = education_mother) %&gt;% summarise(P_mother = survey_mean(vartype = c(&quot;se&quot;, &quot;cv&quot;))) tab_02_zone_mother_P &lt;- tab_02_zone_mother %&gt;% transmute(zone, Education , P_mother) %&gt;% pivot_wider( names_from = zone , values_from = P_mother, values_fill = list(P_mother = 0), names_prefix = &quot;P_mother&quot; ) This block merges the education estimates for biological mothers and fathers into a single consolidated summary table. Using inner_join(), it combines the estimated national proportions and zone-level proportions (urban and rural) for each education category. The final table displays the proportion of fathers and mothers attaining each education level, both nationally and by area type. This layout enables direct comparisons between parents and across geographic settings, supporting analyses of intergenerational educational gaps and territorial disparities. ## Merging tables tab_02 &lt;- inner_join(tab_02_tot_mother, tab_02_tot_father) %&gt;% inner_join(inner_join(tab_02_zone_father_P, tab_02_zone_mother_P)) %&gt;% select( Education, P_father_National, P_mother_National, matches(&quot;RURAL&quot;), matches(&quot;URBAN&quot;) ) tab_02 The table summarizes the educational attainment of biological mothers and fathers of individuals under 18, disaggregated by urban and rural areas and presented with national-level estimates Education P_father_National P_mother_National P_father1. RURAL P_mother1. RURAL P_father2. URBAN P_mother2. URBAN 01 No education 0.4742726 0.6970287 0.5237719 0.7726926 0.2968080 0.4257586 02 Primary 0.4032306 0.2367733 0.4164563 0.2111184 0.3558137 0.3287513 03 Secondary 0.0750082 0.0437780 0.0415414 0.0130762 0.1949932 0.1538501 04 Above secondary 0.0474887 0.0224200 0.0182305 0.0031128 0.1523851 0.0916400 Testing for Independence This block creates a weighted contingency table between the mother’s education level and the type of residence area, based on the complex survey design. The Ntotal = 1 option scales the table to proportions. The addmargins() function adds marginal totals for easier interpretation. The output provides insight into the distribution of maternal education across geographic settings. #------------------------------------------------------------------------------# # Testing for Independence # #------------------------------------------------------------------------------# ## Cross-tabulations svytable(~ education_mother + zone, ESS4_design, Ntotal = 1) %&gt;% addmargins() ## zone ## education_mother 1. RURAL 2. URBAN Sum ## 01 No education 0.625877321 0.170044114 0.795921435 ## 02 Primary 0.101217942 0.060196764 0.161414705 ## 03 Secondary 0.006368653 0.022516532 0.028885185 ## 04 Above secondary 0.001366510 0.012412165 0.013778674 ## Sum 0.734830425 0.265169575 1.000000000 This block replicates the above logic, focusing on the father’s education level. It generates a weighted proportion table by urban/rural area, helping identify patterns or differences in paternal education across zones. svytable(~ education_father + zone, ESS4_design, Ntotal = 1) %&gt;% addmargins() ## zone ## education_father 1. RURAL 2. URBAN Sum ## 01 No education 0.493907929 0.134858962 0.628766892 ## 02 Primary 0.211495391 0.073860235 0.285355626 ## 03 Secondary 0.020643258 0.032062777 0.052706034 ## 04 Above secondary 0.008783846 0.024387602 0.033171448 ## Sum 0.734830425 0.265169575 1.000000000 This block applies a design-adjusted chi-square test to evaluate the statistical independence between mother’s education and area of residence. A p-value less than 0.05 indicates a significant association, meaning education levels vary meaningfully by zone. ## Chi-square tests svychisq(~ education_mother + zone, ESS4_design) ## ## Pearson&#39;s X^2: Rao &amp; Scott adjustment ## ## data: NextMethod() ## F = 100.29, ndf = 2.0376, ddf = 1047.3152, p-value &lt; 2.2e-16 The adjusted chi-square test (Rao &amp; Scott) for the association between maternal education and residential zone yields a highly significant result (F = 100.29, p &lt; 0.001). This confirms a statistically significant relationship between both variables, rejecting the null hypothesis of independence. The strength of this association suggests that a mother’s educational level is strongly linked to whether she lives in a rural or urban zone. This block repeats the previous test but for father’s education. It checks whether paternal education is statistically dependent on whether the household resides in a rural or urban area. svychisq(~ education_father + zone, ESS4_design) ## ## Pearson&#39;s X^2: Rao &amp; Scott adjustment ## ## data: NextMethod() ## F = 76.817, ndf = 2.8926, ddf = 1486.7710, p-value &lt; 2.2e-16 Similarly, the chi-square test for paternal education also shows a significant association (F = 76.82, p &lt; 0.001). Although the F statistic is slightly lower than for mothers, the relationship remains very strong. This reinforces the conclusion that fathers’ educational levels vary significantly by residential zone, with a clear trend toward higher education in urban environments. "],["tests-for-group-comparisons.html", "4.4 Tests for Group Comparisons", " 4.4 Tests for Group Comparisons This section presents a comprehensive analysis of expenditure disparities across urban and rural areas in Ethiopia using the ESS4 survey data. The code performs three key operations: (1) calculates weighted mean expenditures at national and regional levels, (2) compares urban-rural differences through descriptive statistics, and (3) conducts formal hypothesis testing using design-adjusted t-tests. The analysis properly accounts for the complex survey design through stratification, clustering, and sampling weights, enabling robust estimation of expenditure patterns and their statistical significance across different geographic classifications. Prepare the work environment This block begins a new section of the analysis focused on computing per capita expenditure using data from the nonfood expenditure module of the ESS4 household questionnaire. It starts by cleaning the R environment and loading the required libraries for processing and analyzing complex survey data. Then, the nonfood expenditure dataset is imported and transformed to compute total household expenditure, considering only items that were actually purchased (based on s7q03). The household cover dataset is then loaded and merged at the household level, allowing the calculation of per capita expenditure by dividing total expenditure by household size (saq09). This variable will serve as the basis for analyzing expenditure distribution and inequality. #------------------------------------------------------------------------------# # Cleaning R Environment # #------------------------------------------------------------------------------# rm(list = ls()) gc() ## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 542703 29.0 1220337 65.2 660485 35.3 ## Vcells 957081 7.4 8388608 64.0 1770410 13.6 #------------------------------------------------------------------------------# # Libraries # #------------------------------------------------------------------------------# library(tidyverse) library(survey) library(srvyr) library(data.table) library(magrittr) library(haven) library(stringr) library(tidyr) library(knitr) library(kableExtra) # Ensure select function from dplyr is used explicitly select &lt;- dplyr::select #------------------------------------------------------------------------------# # Setting the RAM Memory Limit # #------------------------------------------------------------------------------# memory.limit(250000000) ## [1] Inf #------------------------------------------------------------------------------# # Loading Datasets # #------------------------------------------------------------------------------# EXP_data &lt;- read_sav(&quot;data/data_ESS4/sect7b_hh_w4_v2.sav&quot;) %&gt;% mutate(expenditure = ifelse(s7q03 == 2, 0, s7q04)) %&gt;% group_by(household_id) %&gt;% summarise(total_expenditure = sum(expenditure, na.rm = TRUE)) HH_data &lt;- read_sav(&quot;data/data_ESS4/sect_cover_hh_w4.sav&quot;) #------------------------------------------------------------------------------# # Processing Per Capita Expenditure # #------------------------------------------------------------------------------# # Merging household data with expenditure data HH_data &lt;- HH_data %&gt;% inner_join(EXP_data) %&gt;% mutate(percapita_expenditure = total_expenditure / saq09) This block reuses the complex survey design structure previously documented. It is based on stratification by region and area of residence, with primary sampling (ea_id) and adjusted sampling weights (pw_w4). This setup ensures that subsequent estimates properly reflect the ESS4 survey’s sampling design. #------------------------------------------------------------------------------# # Defining Survey Design # #------------------------------------------------------------------------------# ESS4_design &lt;- HH_data %&gt;% mutate(strata = paste0(saq01, &quot;_&quot;, saq14)) %&gt;% as_survey_design( ids = ea_id, # Primary sampling unit identifier (EA) strata = strata, # Stratification by region (saq01) and urban/rural zone (saq14) weights = pw_w4, # Final adjusted weight nest = TRUE ) Conducting Group Comparisons on expenditure This block compares average per capita expenditure between urban and rural areas. Using the complex survey design, it estimates the mean (M_hat) per person, along with its standard error (M_hat_se) and 95% confidence interval (M_hat_low, M_hat_upp) for each group (saq14). The results reveal a clear disparity: average expenditure in urban areas (1,924 ) is more than double that of rural areas (762 ), highlighting differences in living standards between the two settings. #------------------------------------------------------------------------------# # Conducting Group Comparisons on expenditure # #------------------------------------------------------------------------------# # Mean estimates by urban/rural classification ESS4_design %&gt;% group_by(saq14 = as_factor(saq14)) %&gt;% summarise(M_hat = survey_mean(percapita_expenditure, vartype = c(&quot;se&quot;, &quot;ci&quot;))) %&gt;% data.frame() saq14 M_hat M_hat_se M_hat_low M_hat_upp RURAL 762.2367 46.77375 670.3454 854.1279 URBAN 1923.6611 122.61229 1682.7782 2164.5439 This code calculates mean per capita expenditure estimates across Ethiopian regions, disaggregated by urban/rural classification. Using the complex survey design, it computes weighted means along with their standard errors and 95% confidence intervals. The results reveal substantial expenditure disparities between urban and rural areas within each region, with urban expenditures consistently higher. The output provides a comprehensive regional comparison of living standards measured through household consumption. # Mean estimates by region and urban/rural classification ESS4_design %&gt;% group_by(saq01 = as_factor(saq01), saq14 = as_factor(saq14)) %&gt;% summarise(M_hat = survey_mean(percapita_expenditure, vartype = c(&quot;se&quot;, &quot;ci&quot;))) %&gt;% data.frame() saq01 saq14 M_hat M_hat_se M_hat_low M_hat_upp TIGRAY RURAL 852.5512 79.93799 695.5058 1009.5966 TIGRAY URBAN 2565.2175 383.01676 1812.7466 3317.6884 AFAR RURAL 766.4125 58.10544 652.2591 880.5659 AFAR URBAN 1784.2278 342.18364 1111.9773 2456.4784 AMHARA RURAL 877.3044 83.74863 712.7727 1041.8361 AMHARA URBAN 1922.8472 292.45077 1348.3014 2497.3931 OROMIA RURAL 717.1906 93.29886 533.8966 900.4846 OROMIA URBAN 1552.5761 245.51239 1070.2449 2034.9073 SOMALI RURAL 719.7615 65.11979 591.8278 847.6952 SOMALI URBAN 1213.0200 257.61110 706.9198 1719.1202 BENISHANGUL GUMUZ RURAL 573.0041 138.79989 300.3192 845.6890 BENISHANGUL GUMUZ URBAN 2055.9192 418.47403 1233.7893 2878.0491 SNNP RURAL 685.0844 91.82519 504.6855 865.4833 SNNP URBAN 2028.3977 322.23242 1395.3431 2661.4523 GAMBELA RURAL 719.4405 132.98837 458.1729 980.7081 GAMBELA URBAN 1409.8242 230.24420 957.4888 1862.1597 HARAR RURAL 1021.3977 203.74204 621.1282 1421.6673 HARAR URBAN 2189.4942 344.36234 1512.9634 2866.0250 ADDIS ABABA URBAN 2477.1572 238.02029 2009.5449 2944.7694 DIRE DAWA RURAL 989.0894 284.64509 429.8785 1548.3003 DIRE DAWA URBAN 1886.9075 184.02205 1525.3796 2248.4354 Hypothesis Testing for Group Comparisons This block performs a hypothesis test to compare per capita expenditure between urban and rural areas using the complex survey design. The svyttest() function applies a design-adjusted t-test to assess whether the mean expenditures differ significantly between groups. The result yields a t-statistic of 8.85 with a p-value &lt; 0.001, indicating a highly significant difference between areas. The 95% confidence interval for the mean difference ranges from 904 to 1,419 , with an estimated average difference of 1,161 in favor of urban areas. These results confirm a substantial inequality in per capita spending by residential location. #------------------------------------------------------------------------------# # Hypothesis Testing for Group Comparisons # #------------------------------------------------------------------------------# # Overall comparison between urban and rural areas svyttest(percapita_expenditure ~ saq14, design = ESS4_design, level = 0.95) ## ## Design-based t-test ## ## data: percapita_expenditure ~ saq14 ## t = 8.8502, df = 513, p-value &lt; 2.2e-16 ## alternative hypothesis: true difference in mean is not equal to 0 ## 95 percent confidence interval: ## 903.6082 1419.2406 ## sample estimates: ## difference in mean ## 1161.424 Regional Comparison for Region 1 (Tigray) This analysis compares mean per capita expenditure between urban and rural areas in Region 1 (Tigray) using a survey-weighted t-test. The highly significant result (t = 4.3772, p &lt; 0.0001) indicates urban households spend on average 1,712.67 more than rural households, with 95% confidence that the true difference lies between 927.16 and 2,498.17. # Comparison within region 1 svyttest( percapita_expenditure ~ saq14, design = ESS4_design %&gt;% filter(saq01 == 1), level = 0.95 ) ## ## Design-based t-test ## ## data: percapita_expenditure ~ saq14 ## t = 4.3772, df = 51, p-value = 5.97e-05 ## alternative hypothesis: true difference in mean is not equal to 0 ## 95 percent confidence interval: ## 927.1597 2498.1729 ## sample estimates: ## difference in mean ## 1712.666 Regional Comparison for Region 2 (Afar) This test examines expenditure differences between urban and rural areas in Region 2 (Afar). The statistically significant result (t = 2.9325, p = 0.00554) shows urban households spend 1,017.82 more on average than rural households. The 95% confidence interval (316.34 to 1,719.29) suggests slightly more variability in this region compared to Tigray. # Comparison within region 2 svyttest( percapita_expenditure ~ saq14, design = ESS4_design %&gt;% filter(saq01 == 2), level = 0.95 ) ## ## Design-based t-test ## ## data: percapita_expenditure ~ saq14 ## t = 2.9325, df = 40, p-value = 0.00554 ## alternative hypothesis: true difference in mean is not equal to 0 ## 95 percent confidence interval: ## 316.3365 1719.2941 ## sample estimates: ## difference in mean ## 1017.815 "],["linear-models.html", "5.3 Linear Models", " 5.3 Linear Models This section presents a comprehensive analysis of household expenditure determinants using Ethiopia’s 2018/19 Socioeconomic Survey (ESS4) data. The workflow processes demographic variables and expenditure data, implements proper survey weighting methodology, and estimates linear regression models to examine how factors like urban/rural residence, religion, gender, and age influence per capita spending. The analysis employs log-transformed expenditure as the outcome variable and includes interaction terms to assess differential effects across population subgroups, while rigorously accounting for the complex survey design through appropriate weighting, stratification, and clustering adjustments. Prepare the work environment This initial block prepares the environment for conducting statistical analysis using data from the Ethiopia Socioeconomic Survey (ESS4). It begins by clearing the R workspace and performing garbage collection, ensuring a clean and efficient session. Then, it loads the necessary libraries for complex survey analysis, data manipulation (dplyr, data.table), data import (haven), visualization (ggplot2), and model diagnostics (svydiags, broom). Next, two key datasets are imported from SPSS (.sav) files: - EXP_data contains nonfood household expenditure records, where total household expenditure is computed by summing reported items, assigning zero for items not purchased. - IND_data includes general household information, such as demographic and socioeconomic characteristics, which will be merged later with the expenditure data for further analysis. #------------------------------------------------------------------------------# # Cleaning R Environment # #------------------------------------------------------------------------------# rm(list = ls()) gc() ## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 542614 29.0 1220082 65.2 660485 35.3 ## Vcells 957440 7.4 8388608 64.0 1770406 13.6 #------------------------------------------------------------------------------# # Libraries # #------------------------------------------------------------------------------# library(dplyr) library(survey) library(srvyr) library(data.table) library(magrittr) library(haven) library(stringr) library(tidyr) library(knitr) library(kableExtra) library(ggplot2) library(svydiags) library(broom) # Ensure the correct use of dplyr&#39;s select function select &lt;- dplyr::select #------------------------------------------------------------------------------# # Loading Datasets # #------------------------------------------------------------------------------# ## Household expenditure data EXP_data &lt;- read_sav(&quot;data/data_ESS4/sect7b_hh_w4_v2.sav&quot;) %&gt;% mutate(expenditure = ifelse(s7q03 == 2, 0, s7q04)) %&gt;% group_by(household_id) %&gt;% summarise(total_expenditure = sum(expenditure, na.rm = TRUE)) ## General household information IND_data &lt;- read_sav(&quot;data/data_ESS4/sect1_hh_w4.sav&quot;) Processing Demographic Information This block processes key demographic information from Section 1 of the ESS4 household questionnaire. A new dataset called IND_data_age is created by selecting and transforming relevant variables for subsequent analysis. These include the household and individual identifiers, enumeration area (ea_id), final survey weights (pw_w4), region (saq01), and urban/rural classification (saq14). A stratification variable (strata) is also defined by combining region and zone. A new categorical variable, age_group, classifies adults (18 years or older) into four age groups: 18–30, 31–45, 46–65, and 66 or more. The dataset also includes sex (Sex) and religion (Religion), with less frequent religious groups (such as “PEGAN”, “TRADITIONAL”, “WAKEFETA”, and “OTHER (SPECIFY)”) recoded into a unified \"OTHER\" category. Missing values are handled accordingly, ensuring a standardized and robust structure for reliable demographic analyses. #------------------------------------------------------------------------------# # Processing Demographic Information # #------------------------------------------------------------------------------# ## Age grouping and demographic characteristics IND_data_age &lt;- IND_data %&gt;% transmute( household_id, individual_id, ea_id, # Primary sampling unit identifier (EA) pw_w4, saq01, # Region Zone = as_factor(saq14), # Urban/Rural classification strata = paste0(saq01, &quot;_&quot;, saq14), # Stratification region-zone s1q03a, # Age in years age_group = case_when( s1q03a &lt; 18 ~ NA_character_, s1q03a &lt; 31 ~ &quot;18-30&quot;, s1q03a &lt; 46 ~ &quot;31-45&quot;, s1q03a &lt; 66 ~ &quot;46-65&quot;, TRUE ~ &quot;66 or more&quot; ), Sex = as_factor(s1q02), Religion = as_factor(s1q08) %&gt;% recode( &quot;6. PEGAN&quot; = &quot;OTHER&quot;, &quot;5. TRADITIONAL&quot; = &quot;OTHER&quot;, &quot;8. OTHER (SPECIFY)&quot; = &quot;OTHER&quot;, &quot;7. WAKEFETA&quot; = &quot;OTHER&quot; ) %&gt;% replace_na(&quot;OTHER&quot;) ) This block prepares an integrated dataset with sociodemographic information, marital status, and per capita household expenditure for regression analysis. First, it processes the marital status (s1q09) by converting it into a readable character format and assigning \"not answered\" to missing values. Then, it calculates per capita household expenditure by dividing total household expenditure (total_expenditure) by household size (saq09), based on the household roster. Next, three datasets are merged: 1. IND_data_age: demographic variables (age, sex, religion, age group, zone). 2. IND_data1_marital: marital status. 3. HH_data_expenditure: per capita household spending. The resulting dataset, IND_data_regression, is filtered to include only individuals aged 18 and above, aligning with standard practices in adult socioeconomic analysis. Lastly, the processed dataset is saved as an .rds file for use in upcoming regression modeling. #------------------------------------------------------------------------------# # Processing Marital Status # #------------------------------------------------------------------------------# IND_data1 &lt;- read_sav(&quot;data/data_ESS4/sect1_hh_w4.sav&quot;) IND_data1_marital &lt;- IND_data1 %&gt;% transmute(household_id, individual_id, s1q09 = as.character(as_factor(s1q09)) %&gt;% replace_na(&quot;not answered&quot;)) #------------------------------------------------------------------------------# # Household Expenditure Per Capita # #------------------------------------------------------------------------------# HH_data &lt;- read_sav(&quot;data/data_ESS4/sect_cover_hh_w4.sav&quot;) %&gt;% inner_join(EXP_data, by = &quot;household_id&quot;) HH_data_expenditure &lt;- HH_data %&gt;% transmute(household_id, percapita_expenditure = total_expenditure / saq09) #------------------------------------------------------------------------------# # Merging Datasets for Regression Analysis # #------------------------------------------------------------------------------# IND_data_regression &lt;- IND_data_age %&gt;% inner_join(IND_data1_marital, by = c(&quot;household_id&quot;, &quot;individual_id&quot;)) %&gt;% inner_join(HH_data_expenditure, by = &quot;household_id&quot;) %&gt;% filter(s1q03a &gt;= 18) # Saving processed dataset saveRDS(IND_data_regression, &quot;data/data_ESS4/IND_data_regression.rds&quot;) This block reuses the previously defined complex survey design (ESS4_design) to fit a linear regression model on the logarithm of per capita expenditure (log_expenditure). The aim is to explore how demographic and social characteristics—such as age group, sex, religion, and marital status—are associated with individuals’ spending levels. This analysis helps uncover systematic consumption differences across population subgroups, while accounting for the ESS4’s stratified design and sample weights. #------------------------------------------------------------------------------# # Defining Survey Design # #------------------------------------------------------------------------------# ESS4_design &lt;- IND_data_regression %&gt;% filter(percapita_expenditure &gt; 0) %&gt;% as_survey_design( ids = ea_id, # Primary sampling unit identifier (EA) strata = strata, # Stratification by region (saq01) and urban/rural zone (Zone) weights = pw_w4, # Final adjusted weight nest = TRUE ) %&gt;% mutate(log_expenditure = log(percapita_expenditure + 70)) options(survey.lonely.psu = &quot;fail&quot;) # Adjust to handle singleton PSUs summary(ESS4_design) ## Stratified 1 - level Cluster Sampling design (with replacement) ## With (534) clusters. ## Called via srvyr ## Probabilities: ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 3.932e-05 1.763e-04 7.591e-04 2.577e-03 3.962e-03 1.317e-01 ## Stratum Sizes: ## 1_1 1_2 12_1 12_2 13_1 13_2 14_2 15_1 15_2 2_1 2_2 3_1 3_2 4_1 4_2 ## obs 919 517 430 596 388 668 1923 316 901 662 393 1105 481 1026 591 ## design.PSU 35 19 18 20 18 24 52 14 28 28 15 43 18 43 20 ## actual.PSU 35 19 18 20 18 24 52 14 28 28 15 43 18 43 20 ## 5_1 5_2 6_1 6_2 7_1 7_2 ## obs 763 549 360 327 989 532 ## design.PSU 35 17 16 13 40 18 ## actual.PSU 35 17 16 13 40 18 ## Data variables: ## [1] &quot;household_id&quot; &quot;individual_id&quot; &quot;ea_id&quot; ## [4] &quot;pw_w4&quot; &quot;saq01&quot; &quot;Zone&quot; ## [7] &quot;strata&quot; &quot;s1q03a&quot; &quot;age_group&quot; ## [10] &quot;Sex&quot; &quot;Religion&quot; &quot;s1q09&quot; ## [13] &quot;percapita_expenditure&quot; &quot;log_expenditure&quot; Estimating Linear Models The model specification block implements a weighted linear regression using the svyglm() function, analyzing log-transformed per capita expenditure as the dependent variable. The model includes main effects for area (urban/rural), religion, gender, and age groups, along with interaction terms between area and religion to assess differential effects. The inclusion of the ESS4_design object ensures all estimates incorporate sampling weights, region/area stratification, and primary sampling unit clustering, meeting complex data analysis requirements. #------------------------------------------------------------------------------# # Estimating Linear Models # #------------------------------------------------------------------------------# # Survey-weighted linear model for log expenditure EXP_model &lt;- svyglm(log_expenditure ~ 1 + Zone * Religion + Zone + Sex + age_group, design = ESS4_design) The model results reveal significant patterns: urban households show 62% higher expenditure than rural ones (\\(\\beta=0.622\\), \\(p&lt;0.001\\)), while female-headed households spend on average 6.2% less. Notable religious disparities emerge, with Catholic (-84%), Protestant (-38%), and Muslim (-53%) households showing lower expenditure than the reference group. The significant area-religion interaction (e.g., +90% for urban Catholics) indicates the urban economic advantage varies substantially by religious affiliation. All coefficients are interpretable as percentage differences thanks to the logarithmic transformation of the response variable. # Display model coefficients summary(EXP_model) ## ## Call: ## svyglm(formula = log_expenditure ~ 1 + Zone * Religion + Zone + ## Sex + age_group, design = ESS4_design) ## ## Survey design: ## Called via srvyr ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 6.75103 0.06376 105.882 &lt; 2e-16 *** ## Zone2. URBAN 0.62235 0.08999 6.916 1.43e-11 *** ## Religion2. CATHOLIC -0.83665 0.33704 -2.482 0.01338 * ## Religion3. PROTESTANT -0.37824 0.09629 -3.928 9.76e-05 *** ## Religion4. MUSLEM -0.52809 0.08640 -6.112 1.98e-09 *** ## ReligionOTHER -0.27937 0.10867 -2.571 0.01043 * ## Sex2. Female -0.06211 0.01450 -4.284 2.20e-05 *** ## age_group31-45 -0.08358 0.02644 -3.161 0.00167 ** ## age_group46-65 -0.09009 0.03114 -2.893 0.00398 ** ## age_group66 or more -0.17498 0.06199 -2.823 0.00495 ** ## Zone2. URBAN:Religion2. CATHOLIC 0.90298 0.39443 2.289 0.02248 * ## Zone2. URBAN:Religion3. PROTESTANT 0.25355 0.13325 1.903 0.05763 . ## Zone2. URBAN:Religion4. MUSLEM 0.16567 0.12553 1.320 0.18752 ## Zone2. URBAN:ReligionOTHER -0.65549 0.28641 -2.289 0.02252 * ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for gaussian family taken to be 0.7269917) ## ## Number of Fisher Scoring iterations: 2 The model summary provides robust standard errors, t-values, and significance levels for each parameter, identifying statistically relevant effects (p&lt;0.001). The dispersion parameter (0.727) and convergence iterations offer information about model fit. Direct coefficient extraction via coef() facilitates their use in further analysis. Importantly, confidence intervals and p-values are properly adjusted for the complex survey design, ensuring valid population-level inferences. EXP_model %&gt;% coef() ## (Intercept) Zone2. URBAN ## 6.75103013 0.62235134 ## Religion2. CATHOLIC Religion3. PROTESTANT ## -0.83664621 -0.37824277 ## Religion4. MUSLEM ReligionOTHER ## -0.52808542 -0.27937202 ## Sex2. Female age_group31-45 ## -0.06210920 -0.08358242 ## age_group46-65 age_group66 or more ## -0.09008758 -0.17498242 ## Zone2. URBAN:Religion2. CATHOLIC Zone2. URBAN:Religion3. PROTESTANT ## 0.90298319 0.25355058 ## Zone2. URBAN:Religion4. MUSLEM Zone2. URBAN:ReligionOTHER ## 0.16566844 -0.65548554 "],["working-with-weights.html", "5.4 Working with Weights", " 5.4 Working with Weights This chapter examines the impact of different weight adjustments on linear models fitted to complex survey data. Using a processed version of Ethiopia’s ESS4 survey, three calibrated versions of the original survey weights are constructed: Senate-style weights, normalized weights, and weights adjusted using Pfeffermann’s method. Alternative survey designs are then defined, and weighted regression models are estimated to assess how results vary depending on the weighting scheme. This analysis allows for the evaluation of the robustness of conclusions and the influence of weights on patterns of per capita expenditure. Prepare the work environment This initial block sets up the working environment to continue with the regression analysis using previously processed ESS4 data. It begins by clearing the memory and loading the necessary libraries for data manipulation, complex survey design, and statistical modeling. Then, it imports the IND_data_regression dataset, which contains individual-level demographic characteristics and per capita expenditure, ready to be used in linear models or other inferential techniques. #------------------------------------------------------------------------------# # Cleaning R Environment # #------------------------------------------------------------------------------# # Remove all objects from the environment to avoid conflicts rm(list = ls()) # Perform garbage collection to free memory gc() ## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 542645 29.0 1220171 65.2 660485 35.3 ## Vcells 957251 7.4 8388608 64.0 1770406 13.6 #------------------------------------------------------------------------------# # Libraries # #------------------------------------------------------------------------------# # Load necessary libraries for data manipulation, survey design, and visualization library(dplyr) library(survey) library(srvyr) library(data.table) library(magrittr) library(haven) library(tidyr) library(ggplot2) library(broom) # Ensure dplyr&#39;s select function is explicitly used to avoid conflicts select &lt;- dplyr::select #------------------------------------------------------------------------------# # Loading Dataset # #------------------------------------------------------------------------------# # Load the survey dataset IND_data_regression &lt;- readRDS(&quot;data/data_ESS4/IND_data_regression.rds&quot;) This block performs survey weight calibration, generating two adjusted versions of the original weights (pw_w4): - Senate weights (pw_Senate): scale the original weights so that their total equals the sample size. These are often used in variance estimation or for comparison across subsamples. - Normalized weights (pw_Normalized): rescale the weights to sum to exactly 1, which is useful for statistical or machine learning models that require relative weights rather than population expansion factors. These transformations increase analytical flexibility while preserving the representativeness of the survey design. #------------------------------------------------------------------------------# # Weight Calibration and Adjustments # #------------------------------------------------------------------------------# # Create different weight adjustments: IND_data_regression &lt;- IND_data_regression %&gt;% mutate( # Senate Weights: Adjust original survey weights to sum up to the sample size pw_Senate = pw_w4 * (n() / sum(pw_w4)), # Normalized Weights: Scale original weights so they sum up to 1 pw_Normalized = pw_w4 / sum(pw_w4) ) This block implements Pfeffermann’s regression-based weight calibration method, which uses a linear model to adjust the original survey weights (pw_w4). A regression is fitted using demographic and social variables—such as area (urban/rural), religion, sex, and age group—as predictors. The fitted values from the model represent expected weights under the model structure. The calibrated weight (pw_Pfeffermann) is then computed as the ratio of the original weight to the predicted value. This method improves efficiency and reduces design bias while preserving the survey design structure. # Calibrate weights using Pfeffermann’s regression-based method EXP_model_pw_w4 &lt;- lm(pw_w4 ~ 1 + Zone * Religion + Zone + Sex + age_group, data = IND_data_regression) # Predicted values for weight calibration pw_w4_pred &lt;- predict(EXP_model_pw_w4) # Apply Pfeffermann’s weight calibration IND_data_regression &lt;- IND_data_regression %&gt;% mutate(pw_Pfeffermann = pw_w4 / pw_w4_pred) Descriptive Analysis This code block performs a comparative analysis of different sampling weights used in Ethiopia’s ESS4 survey. First, it generates descriptive statistics (minimum, maximum, mean, and quartiles) for four weight variants: the original weights (pw_w4) and three calibrated versions (Senate, Normalized, and Pfeffermann). Then, through scatter plots, it visualizes the relationships between the original weights and each set of calibrated weights, enabling identification of recalibration patterns and comparison of their distributions. #------------------------------------------------------------------------------# # Descriptive Analysis # #------------------------------------------------------------------------------# # Display summary statistics for each weight type summary(IND_data_regression$pw_Senate) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 0.002501 0.081805 0.432992 1.000000 1.734752 8.376216 summary(IND_data_regression$pw_Normalized) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 1.630e-07 5.331e-06 2.822e-05 6.517e-05 1.131e-04 5.459e-04 summary(IND_data_regression$pw_Pfeffermann) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 0.002143 0.126731 0.628265 1.000132 1.427941 8.158340 summary(IND_data_regression$pw_w4) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 7.594 248.383 1314.681 3036.271 5267.178 25432.466 # Compare original and calibrated weights using scatter plots par(mfrow = c(1, 3)) # Set layout for multiple plots # Plot: Original vs. Senate Weights plot( IND_data_regression$pw_w4, IND_data_regression$pw_Senate, main = &quot;Original vs. Senate Weights&quot;, xlab = &quot;Original Weights&quot;, ylab = &quot;Senate Weights&quot; ) # Plot: Original vs. Normalized Weights plot( IND_data_regression$pw_w4, IND_data_regression$pw_Normalized, main = &quot;Original vs. Normalized Weights&quot;, xlab = &quot;Original Weights&quot;, ylab = &quot;Normalized Weights&quot; ) # Plot: Original vs. Pfeffermann Weights plot( IND_data_regression$pw_w4, IND_data_regression$pw_Pfeffermann, main = &quot;Original vs. Pfeffermann Weights&quot;, xlab = &quot;Original Weights&quot;, ylab = &quot;Pfeffermann Weights&quot; ) Defining Survey Designs This code block sets up four alternative survey designs for analyzing Ethiopia’s ESS4 data, each using a different weighting approach: Original Design (ESS4_design): Uses the original survey weights (pw_w4) Senate Weights Design (design_Senate): Applies Senate-calibrated weights Normalized Weights Design (design_Normalized): Uses normalized weights Pfeffermann Weights Design (design_Pfeffermann): Implements Pfeffermann’s method weights Each design: - Filters observations with positive per capita expenditure Specifies primary sampling units (ea_id) Defines stratification (strata) Includes logarithmic transformation of expenditure (with +70 adjustment for zeros) Configures handling of single PSUs through survey.lonely.psu = \"fail\" #------------------------------------------------------------------------------# # Defining Survey Designs # #------------------------------------------------------------------------------# # Set options to handle single PSU issues options(survey.lonely.psu = &quot;fail&quot;) # Define survey designs using different weights # Design with original weights ESS4_design &lt;- IND_data_regression %&gt;% filter(percapita_expenditure &gt; 0) %&gt;% as_survey_design( ids = ea_id, # Primary sampling unit (PSU) strata = strata, # Stratification variable weights = pw_w4, # Use original weights nest = TRUE ) %&gt;% mutate(log_expenditure = log(percapita_expenditure + 70)) # Design with Senate Weights design_Senate &lt;- IND_data_regression %&gt;% filter(percapita_expenditure &gt; 0) %&gt;% as_survey_design( ids = ea_id, strata = strata, weights = pw_Senate, # Use Senate Weights nest = TRUE ) %&gt;% mutate(log_expenditure = log(percapita_expenditure + 70)) # Design with Normalized Weights design_Normalized &lt;- IND_data_regression %&gt;% filter(percapita_expenditure &gt; 0) %&gt;% as_survey_design( ids = ea_id, strata = strata, weights = pw_Normalized, # Use Normalized Weights nest = TRUE ) %&gt;% mutate(log_expenditure = log(percapita_expenditure + 70)) # Design with Pfeffermann’s Weights design_Pfeffermann &lt;- IND_data_regression %&gt;% filter(percapita_expenditure &gt; 0) %&gt;% as_survey_design( ids = ea_id, strata = strata, weights = pw_Pfeffermann, # Use Pfeffermann Weights nest = TRUE ) %&gt;% mutate(log_expenditure = log(percapita_expenditure + 70)) Estimating Linear Models This block fits survey-weighted linear models using different weighting schemes. A common model formula (formula_model) is defined, modeling the log of per capita expenditure as a function of demographic and social characteristics—area (urban/rural), religion, sex, and age group—with an interaction term between area and religion. Then, four versions of the model are estimated using svyglm(): EXP_model_Classic: using the original design weights (ESS4_design), EXP_model_Senate: using weights scaled to the sample size, EXP_model_Normalized: using weights normalized to sum to one, EXP_model_Pfeffermann: using weights calibrated with Pfeffermann’s method. This strategy enables a sensitivity analysis of regression results to different weighting methods, ensuring robustness and validity in survey-based inference. #------------------------------------------------------------------------------# # Estimating Linear Models # #------------------------------------------------------------------------------# # Define the regression model formula formula_model &lt;- as.formula( log_expenditure ~ 1 + Zone * Religion + Zone + Sex + age_group ) # Estimate models using different survey designs EXP_model_Classic &lt;- svyglm(formula_model, design = ESS4_design) EXP_model_Senate &lt;- svyglm(formula_model, design = design_Senate) EXP_model_Normalized &lt;- svyglm(formula_model, design = design_Normalized) EXP_model_Pfeffermann &lt;- svyglm(formula_model, design = design_Pfeffermann) Display regression results This block displays the survey-weighted linear regression results for log-transformed per capita expenditure, estimated using four different weighting schemes: classic, Senate-style, normalized, and Pfeffermann-calibrated. Despite varying weighting methods, the coefficient estimates are remarkably consistent in direction, magnitude, and statistical significance. Key findings include: - Living in an urban area significantly increases per capita spending (≈ +62%). Female individuals spend on average 6%–7% less than males. Older age groups are associated with lower expenditure levels. Clear religious differences emerge, with Catholics and Muslims showing the lowest relative spending. The interaction terms reveal that the urban effect may amplify or mitigate religious gaps. # Display regression results tidy(EXP_model_Classic) tidy(EXP_model_Senate) tidy(EXP_model_Normalized) tidy(EXP_model_Pfeffermann) term estimate std.error statistic p.value (Intercept) 6.7510301 0.0637599 105.882094 0.0000000 Zone2. URBAN 0.6223513 0.0899920 6.915629 0.0000000 Religion2. CATHOLIC -0.8366462 0.3370375 -2.482353 0.0133789 Religion3. PROTESTANT -0.3782428 0.0962860 -3.928327 0.0000976 Religion4. MUSLEM -0.5280854 0.0864032 -6.111875 0.0000000 ReligionOTHER -0.2793720 0.1086689 -2.570856 0.0104329 Sex2. Female -0.0621092 0.0144976 -4.284105 0.0000220 age_group31-45 -0.0835824 0.0264417 -3.161011 0.0016676 age_group46-65 -0.0900876 0.0311394 -2.893044 0.0039817 age_group66 or more -0.1749824 0.0619859 -2.822941 0.0049482 Zone2. URBAN:Religion2. CATHOLIC 0.9029832 0.3944289 2.289343 0.0224753 Zone2. URBAN:Religion3. PROTESTANT 0.2535506 0.1332460 1.902876 0.0576309 Zone2. URBAN:Religion4. MUSLEM 0.1656684 0.1255290 1.319762 0.1875183 Zone2. URBAN:ReligionOTHER -0.6554855 0.2864145 -2.288591 0.0225194 term estimate std.error statistic p.value (Intercept) 6.7510301 0.0637599 105.882094 0.0000000 Zone2. URBAN 0.6223513 0.0899920 6.915629 0.0000000 Religion2. CATHOLIC -0.8366462 0.3370375 -2.482353 0.0133789 Religion3. PROTESTANT -0.3782428 0.0962860 -3.928327 0.0000976 Religion4. MUSLEM -0.5280854 0.0864032 -6.111875 0.0000000 ReligionOTHER -0.2793720 0.1086689 -2.570856 0.0104329 Sex2. Female -0.0621092 0.0144976 -4.284105 0.0000220 age_group31-45 -0.0835824 0.0264417 -3.161011 0.0016676 age_group46-65 -0.0900876 0.0311394 -2.893044 0.0039817 age_group66 or more -0.1749824 0.0619859 -2.822941 0.0049482 Zone2. URBAN:Religion2. CATHOLIC 0.9029832 0.3944289 2.289343 0.0224753 Zone2. URBAN:Religion3. PROTESTANT 0.2535506 0.1332460 1.902876 0.0576309 Zone2. URBAN:Religion4. MUSLEM 0.1656684 0.1255290 1.319762 0.1875183 Zone2. URBAN:ReligionOTHER -0.6554855 0.2864145 -2.288591 0.0225194 term estimate std.error statistic p.value (Intercept) 6.7510301 0.0637599 105.882094 0.0000000 Zone2. URBAN 0.6223513 0.0899920 6.915629 0.0000000 Religion2. CATHOLIC -0.8366462 0.3370375 -2.482353 0.0133789 Religion3. PROTESTANT -0.3782428 0.0962860 -3.928327 0.0000976 Religion4. MUSLEM -0.5280854 0.0864032 -6.111875 0.0000000 ReligionOTHER -0.2793720 0.1086689 -2.570856 0.0104329 Sex2. Female -0.0621092 0.0144976 -4.284105 0.0000220 age_group31-45 -0.0835824 0.0264417 -3.161011 0.0016676 age_group46-65 -0.0900876 0.0311394 -2.893044 0.0039817 age_group66 or more -0.1749824 0.0619859 -2.822941 0.0049482 Zone2. URBAN:Religion2. CATHOLIC 0.9029832 0.3944289 2.289343 0.0224753 Zone2. URBAN:Religion3. PROTESTANT 0.2535506 0.1332460 1.902876 0.0576309 Zone2. URBAN:Religion4. MUSLEM 0.1656684 0.1255290 1.319762 0.1875183 Zone2. URBAN:ReligionOTHER -0.6554855 0.2864145 -2.288591 0.0225194 term estimate std.error statistic p.value (Intercept) 6.7508198 0.0636273 106.099478 0.0000000 Zone2. URBAN 0.6228957 0.0897108 6.943376 0.0000000 Religion2. CATHOLIC -0.8356678 0.3368433 -2.480880 0.0134337 Religion3. PROTESTANT -0.3779453 0.0963726 -3.921711 0.0001002 Religion4. MUSLEM -0.5278803 0.0864502 -6.106179 0.0000000 ReligionOTHER -0.2769243 0.1083221 -2.556488 0.0108678 Sex2. Female -0.0687148 0.0160731 -4.275137 0.0000229 age_group31-45 -0.0757091 0.0260592 -2.905269 0.0038319 age_group46-65 -0.0837546 0.0317003 -2.642075 0.0084982 age_group66 or more -0.1815008 0.0604719 -3.001407 0.0028217 Zone2. URBAN:Religion2. CATHOLIC 0.9038369 0.3955404 2.285069 0.0227267 Zone2. URBAN:Religion3. PROTESTANT 0.2540022 0.1331251 1.907996 0.0569642 Zone2. URBAN:Religion4. MUSLEM 0.1654956 0.1256163 1.317469 0.1882848 Zone2. URBAN:ReligionOTHER -0.6587713 0.2856293 -2.306385 0.0214972 Claro, aquí tienes la traducción al inglés del texto: Comparison and Final Conclusions The systematic comparison of the four models reveals a remarkable consistency in the key results: All models agree on the strong spending advantage of urban households (coefficients between 0.62–0.63) Religious differences show nearly identical magnitudes and statistical significance The age effect follows the same decreasing pattern in all cases The zone–religion interaction terms display very similar coefficients The main variations are observed in: - The effect of being female (ranging from -6.2% to -6.9%) - The impact on individuals aged 66 and older (ranging from -17.5% to -18.2%) - Minor differences in standard errors (&lt;5% variation) These small differences do not affect the substantive conclusions, but they suggest that the Pfeffermann and Senate methods may better capture certain demographic inequalities. The outstanding consistency across models (especially between the original, Senate, and normalized weights) validates the robustness of the findings and indicates that the results are not artifacts of the weighting method. For this particular study, the choice among these weighting schemes would not significantly alter the main conclusions about the determinants of household expenditure in Ethiopia. "],["model-diagnostics.html", "5.5 Model Diagnostics", " 5.5 Model Diagnostics This code performs diagnostic analysis for survey-weighted regression models. It configures the survey design, fits a model for household expenditure, and evaluates it through: 1) \\(R^2\\) calculation, 2) residual analysis (histogram/QQ plots), and 3) influence diagnostics (Cook’s Distance, DFBETAS, DFFITS). The implementation handles complex survey features like stratification and sampling weights. Prepare the work environment This block sets up the working environment to perform diagnostics for linear models using complex survey data. It begins by clearing memory, loading essential libraries, and ensuring correct usage of dplyr::select. Then, it loads the preprocessed dataset (IND_data_regression) and defines the survey design object (ESS4_design), incorporating stratification, primary sampling units (PSU), and calibrated survey weights. Lastly, a log transformation is applied to per capita expenditure to prepare the response variable for subsequent modeling. #------------------------------------------------------------------------------# # Cleaning R Environment # #------------------------------------------------------------------------------# # Remove all objects from the environment to avoid conflicts rm(list = ls()) # Perform garbage collection to free memory gc() ## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 542807 29.0 1220634 65.2 660485 35.3 ## Vcells 957193 7.4 8388608 64.0 1770406 13.6 #------------------------------------------------------------------------------# # Libraries # #------------------------------------------------------------------------------# # Load required packages for data handling, survey analysis, and diagnostics library(dplyr) library(survey) library(srvyr) library(data.table) library(magrittr) library(haven) library(tidyr) library(svydiags) # Survey diagnostics library(ggplot2) library(broom) # Ensure dplyr&#39;s select function is correctly used to avoid conflicts select &lt;- dplyr::select #------------------------------------------------------------------------------# # Loading Dataset # #------------------------------------------------------------------------------# # Load the dataset containing survey information IND_data_regression &lt;- readRDS(&quot;data/data_ESS4/IND_data_regression.rds&quot;) #------------------------------------------------------------------------------# # Defining Survey Design # #------------------------------------------------------------------------------# # Set survey options to avoid errors in single PSU strata options(survey.lonely.psu = &quot;fail&quot;) # Define the survey design object using weighted data ESS4_design &lt;- IND_data_regression %&gt;% filter(percapita_expenditure &gt; 0) %&gt;% as_survey_design( ids = ea_id, # Primary Sampling Units (PSU) strata = strata, # Stratification variable weights = pw_w4, # Sampling weights nest = TRUE ) %&gt;% mutate(log_expenditure = log(percapita_expenditure + 70)) # Log transformation This block fits a linear regression model using the svyglm() function, where the dependent variable is the log of per capita expenditure. The model includes main effects and an interaction between area of residence and religion, as well as sex and age group. This structure allows for exploring how social and demographic factors influence individual spending levels in a statistically sound, design-aware manner. #------------------------------------------------------------------------------# # Estimating Survey-weighted Model # #------------------------------------------------------------------------------# # Define and estimate a survey-weighted regression model EXP_model &lt;- svyglm( log_expenditure ~ 1 + Zone * Religion + Zone + Sex + age_group, design = ESS4_design ) This block displays the statistical summary of the survey-weighted linear model fitted to the ESS4 data. The model examines how demographic and social characteristics—such as area of residence, religion, sex, and age group—are associated with the log of per capita expenditure. The output includes estimated coefficients, standard errors, t-values, and significance levels. Interaction terms between religion and area allow for testing whether religious spending patterns differ across urban and rural settings. The high statistical significance of several predictors confirms their importance in explaining spending behavior. # Display model summary and coefficients summary(EXP_model) ## ## Call: ## svyglm(formula = log_expenditure ~ 1 + Zone * Religion + Zone + ## Sex + age_group, design = ESS4_design) ## ## Survey design: ## Called via srvyr ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 6.75103 0.06376 105.882 &lt; 2e-16 *** ## Zone2. URBAN 0.62235 0.08999 6.916 1.43e-11 *** ## Religion2. CATHOLIC -0.83665 0.33704 -2.482 0.01338 * ## Religion3. PROTESTANT -0.37824 0.09629 -3.928 9.76e-05 *** ## Religion4. MUSLEM -0.52809 0.08640 -6.112 1.98e-09 *** ## ReligionOTHER -0.27937 0.10867 -2.571 0.01043 * ## Sex2. Female -0.06211 0.01450 -4.284 2.20e-05 *** ## age_group31-45 -0.08358 0.02644 -3.161 0.00167 ** ## age_group46-65 -0.09009 0.03114 -2.893 0.00398 ** ## age_group66 or more -0.17498 0.06199 -2.823 0.00495 ** ## Zone2. URBAN:Religion2. CATHOLIC 0.90298 0.39443 2.289 0.02248 * ## Zone2. URBAN:Religion3. PROTESTANT 0.25355 0.13325 1.903 0.05763 . ## Zone2. URBAN:Religion4. MUSLEM 0.16567 0.12553 1.320 0.18752 ## Zone2. URBAN:ReligionOTHER -0.65549 0.28641 -2.289 0.02252 * ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for gaussian family taken to be 0.7269917) ## ## Number of Fisher Scoring iterations: 2 The model shows that living in urban areas is associated with 62% higher per capita spending, while women spend on average 6% less than men. Religious differences are also notable: Catholics, Protestants, and Muslims show significantly lower spending compared to the reference group, although urban Catholics offset this with a +90% interaction effect. Spending decreases with age, particularly among those aged 66 and older (-17.5%). Urban–religion interactions suggest the urban advantage varies across religious groups. tidy(EXP_model) term estimate std.error statistic p.value (Intercept) 6.7510301 0.0637599 105.882094 0.0000000 Zone2. URBAN 0.6223513 0.0899920 6.915629 0.0000000 Religion2. CATHOLIC -0.8366462 0.3370375 -2.482353 0.0133789 Religion3. PROTESTANT -0.3782428 0.0962860 -3.928327 0.0000976 Religion4. MUSLEM -0.5280854 0.0864032 -6.111875 0.0000000 ReligionOTHER -0.2793720 0.1086689 -2.570856 0.0104329 Sex2. Female -0.0621092 0.0144976 -4.284105 0.0000220 age_group31-45 -0.0835824 0.0264417 -3.161011 0.0016676 age_group46-65 -0.0900876 0.0311394 -2.893044 0.0039817 age_group66 or more -0.1749824 0.0619859 -2.822941 0.0049482 Zone2. URBAN:Religion2. CATHOLIC 0.9029832 0.3944289 2.289343 0.0224753 Zone2. URBAN:Religion3. PROTESTANT 0.2535506 0.1332460 1.902876 0.0576309 Zone2. URBAN:Religion4. MUSLEM 0.1656684 0.1255290 1.319762 0.1875183 Zone2. URBAN:ReligionOTHER -0.6554855 0.2864145 -2.288591 0.0225194 Model Fit: \\(R^2\\) Calculation Here, the survey-adjusted R² is computed by comparing the fitted model to a null (intercept-only) model. Total variance and residual variance are extracted from each model summary, and \\(R^2\\) is calculated as the proportion of variance explained by the model. This provides a sense of how well the independent variables explain differences in per capita expenditure. #------------------------------------------------------------------------------# # Model Fit: R² Calculation # #------------------------------------------------------------------------------# # Fit a null model (intercept-only) for R² computation null_model &lt;- svyglm(log(percapita_expenditure + 1) ~ 1, design = ESS4_design) # Extract residual dispersion values s1 &lt;- summary(EXP_model) s0 &lt;- summary(null_model) # Compute weighted R² using total variance and residual variance wSST &lt;- s0$dispersion # Total variance wSSE &lt;- s1$dispersion # Residual variance R2 &lt;- 1 - (wSSE / wSST) # R² formula R2 # Display computed R² value ## variance SE ## [1,] 0.43095 0.0345 Standardized Residuals Analysis This block assesses the distribution of standardized residuals from the fitted model to check the assumption of normality. A histogram overlaid with a theoretical normal curve and a Q-Q plot (quantile–quantile plot) are generated. These visual tools help detect skewness, outliers, or departures from normality that could affect model validity. #------------------------------------------------------------------------------# # Standardized Residuals Analysis # #------------------------------------------------------------------------------# # Compute standardized residuals from the model stdresids &lt;- as.numeric(svystdres(EXP_model)$stdresids) # Attach residuals to the dataset # ESS4_design$variables %&lt;&gt;% mutate(stdresids = stdresids) # Histogram of standardized residuals ggplot(data = data.frame(stdresids), aes(x = stdresids)) + geom_histogram( aes(y = ..density..), bins = 30, fill = &quot;#CCE5FF&quot;, color = &quot;black&quot; ) + stat_function( fun = dnorm, args = list(mean = 0, sd = 1), color = &quot;black&quot;, size = 1 ) + labs(title = &quot;Standardized Residuals&quot;, x = &quot;Residuals&quot;, y = &quot;Density&quot;) + theme_minimal(base_size = 20) + theme(plot.title = element_text(hjust = 0.5)) # Q-Q plot to assess normality of residuals ggplot(data = data.frame(stdresids), aes(sample = stdresids)) + stat_qq() + stat_qq_line(color = &quot;red&quot;) + labs(title = &quot;Q-Q Plot of Standardized Residuals&quot;, x = &quot;Theoretical Quantiles&quot;, y = &quot;Sample Quantiles&quot;) + theme_minimal(base_size = 20)+ theme(plot.title = element_text(hjust = 0.5)) Influential Observations Cook’s Distance This part computes Cook’s Distance to detect observations that have a disproportionate influence on the model’s parameter estimates. Observations exceeding a threshold (e.g., &gt;3) are flagged as influential and visualized in a scatter plot, with red dots indicating high influence. #------------------------------------------------------------------------------# # Influential Observations # #------------------------------------------------------------------------------# #---------------------# # Cook&#39;s Distance # #---------------------# # Compute Cook&#39;s Distance and flag influential observations CooksD &lt;- data.frame( cook = svyCooksD(EXP_model), id = 1:length(svyCooksD(EXP_model)) ) %&gt;% mutate(Criterion = ifelse(cook &gt; 3, &quot;Yes&quot;, &quot;No&quot;)) # Scatter plot of Cook&#39;s Distance ggplot(CooksD, aes(y = cook, x = id)) + geom_point(aes(col = Criterion)) + geom_hline(aes(yintercept = 3), color = &quot;black&quot;, linetype = &quot;dashed&quot;) + scale_color_manual(values = c(&quot;Yes&quot; = &quot;red&quot;, &quot;No&quot; = &quot;black&quot;)) + theme_minimal(base_size = 20) + labs(title = &quot;Cook&#39;s Distance&quot;, x = &quot;Observation ID&quot;, y = &quot;Cook&#39;s D&quot;) DFBETAS The DFBETAS analysis measures how much each coefficient would change if a specific observation were removed. The values are reshaped into long format and plotted with facets, one for each model term. Observations above the threshold are flagged as influential, offering insight into which points affect specific parameters. #---------------------# # DFBETAS Analysis # #---------------------# # Compute DFBETAS for all model coefficients d_dfbetas &lt;- svydfbetas(EXP_model)$Dfbetas %&gt;% t() %&gt;% as.data.frame() # Rename DFBETAS columns colnames(d_dfbetas) &lt;- paste0(&quot;beta[&quot;, seq_len(ncol(d_dfbetas)) - 1, &quot;]&quot;) # Convert DFBETAS to long format d_dfbetas_long &lt;- d_dfbetas %&gt;% mutate(id = row_number()) %&gt;% pivot_longer(cols = -id, names_to = &quot;Variable&quot;, values_to = &quot;value&quot;) # Get threshold for influential observations cutoff &lt;- svydfbetas(EXP_model)$cutoff # Flag influential observations d_dfbetas_long &lt;- d_dfbetas_long %&gt;% mutate(Criterion = ifelse(abs(value) &gt; cutoff, &quot;Yes&quot;, &quot;No&quot;)) # Plot DFBETAS ggplot(d_dfbetas_long , aes(y = abs(value), x = id)) + geom_point(aes(color = Criterion)) + geom_hline(aes(yintercept = cutoff), linetype = &quot;dashed&quot;) + facet_wrap(. ~ Variable, nrow = 4, scales = &quot;free_y&quot;) + scale_color_manual(values = c(&quot;Yes&quot; = &quot;red&quot;, &quot;No&quot; = &quot;black&quot;)) + labs(title = &quot;DFBETAS Analysis&quot;, x = &quot;Observation ID&quot;, y = expression(abs(beta))) + theme_minimal(base_size = 20) DFFITS This section calculates DFFITS, which assesses the influence of each observation on its own predicted value. Observations with high DFFITS are flagged and visualized in a scatter plot, helping identify cases that disproportionately affect fitted values. #---------------------# # DFFITS Analysis # #---------------------# # Compute DFFITS values d_dffits &lt;- data.frame( dffits = svydffits(EXP_model)$Dffits, id = 1:length(svydffits(EXP_model)$Dffits) ) # Get influence threshold cutoff &lt;- svydffits(EXP_model)$cutoff # Flag influential observations d_dffits &lt;- d_dffits %&gt;% mutate(Criterion = ifelse(abs(dffits) &gt; cutoff, &quot;Yes&quot;, &quot;No&quot;)) # Plot DFFITS values ggplot(d_dffits, aes(y = abs(dffits), x = id)) + geom_point(aes(color = Criterion)) + geom_hline(yintercept = cutoff, linetype = &quot;dashed&quot;, color = &quot;black&quot;) + scale_color_manual(values = c(&quot;Yes&quot; = &quot;red&quot;, &quot;No&quot; = &quot;black&quot;)) + labs(title = &quot;DFFITS Influence Analysis&quot;, x = &quot;Observation ID&quot;, y = expression(abs(DFFITS))) + theme_minimal(base_size = 20) "],["inference-on-model-parameters.html", "5.6 Inference on Model Parameters", " 5.6 Inference on Model Parameters This section performs inference on the parameters of a weighted linear regression model fitted to the log of per capita expenditure using ESS4 survey data. Coefficient estimates are extracted, visualized with confidence intervals, and model predictions are compared against observed values. This approach helps identify statistically significant effects and assess overall model fit under a complex survey design. Prepare the work environment This initial block prepares the working environment to perform weighted regressions using ESS4 survey data. It begins by clearing memory and loading the required libraries for complex survey analysis, data handling, and model diagnostics. The processed dataset (IND_data_regression) is then imported, and a complex survey design object (ESS4_design) is defined, incorporating primary sampling units, stratification, and final weights. Finally, per capita expenditure is log-transformed to approximate normality and ensure the validity of linear model assumptions. #------------------------------------------------------------------------------# # Cleaning R Environment # #------------------------------------------------------------------------------# rm(list = ls()) gc() ## used (Mb) gc trigger (Mb) max used (Mb) ## Ncells 542527 29.0 1219834 65.2 660485 35.3 ## Vcells 955994 7.3 8388608 64.0 1770410 13.6 #------------------------------------------------------------------------------# # Libraries # #------------------------------------------------------------------------------# library(dplyr) library(survey) library(srvyr) library(data.table) library(magrittr) library(haven) library(stringr) library(tidyr) library(svydiags) library(ggplot2) library(broom) # Ensure the correct use of dplyr&#39;s select function select &lt;- dplyr::select #------------------------------------------------------------------------------# # Loading Datasets # #------------------------------------------------------------------------------# IND_data_regression &lt;- readRDS(&quot;data/data_ESS4/IND_data_regression.rds&quot;) #------------------------------------------------------------------------------# # Defining the survey design for weighted regression #------------------------------------------------------------------------------# # Set survey options to handle single PSU issues options(survey.lonely.psu = &quot;fail&quot;) # Define survey design with appropriate stratification and weighting ESS4_design &lt;- IND_data_regression %&gt;% filter(percapita_expenditure &gt; 0) %&gt;% as_survey_design( ids = ea_id, # Primary Sampling Unit (PSU) strata = strata, # Stratification variable weights = pw_w4, # Survey weights nest = TRUE ) %&gt;% mutate(log_expenditure = log(percapita_expenditure + 70)) # Log transformation for normality Estimating Linear Models This block estimates a survey-weighted linear regression model using the complex design from the ESS4 dataset. The dependent variable is the log of per capita expenditure, with predictors including area of residence, religion, sex, and age group, as well as an interaction between area and religion. The svyglm() function ensures valid standard errors and inference under the complex design. The code outputs the model summary and estimated coefficients. #------------------------------------------------------------------------------# # Estimating Linear Models # #------------------------------------------------------------------------------# # Survey-weighted linear model for log expenditure EXP_model &lt;- svyglm(log_expenditure ~ 1 + Zone * Religion + Zone + Sex + age_group, design = ESS4_design) # Display model coefficients summary(EXP_model) ## ## Call: ## svyglm(formula = log_expenditure ~ 1 + Zone * Religion + Zone + ## Sex + age_group, design = ESS4_design) ## ## Survey design: ## Called via srvyr ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 6.75103 0.06376 105.882 &lt; 2e-16 *** ## Zone2. URBAN 0.62235 0.08999 6.916 1.43e-11 *** ## Religion2. CATHOLIC -0.83665 0.33704 -2.482 0.01338 * ## Religion3. PROTESTANT -0.37824 0.09629 -3.928 9.76e-05 *** ## Religion4. MUSLEM -0.52809 0.08640 -6.112 1.98e-09 *** ## ReligionOTHER -0.27937 0.10867 -2.571 0.01043 * ## Sex2. Female -0.06211 0.01450 -4.284 2.20e-05 *** ## age_group31-45 -0.08358 0.02644 -3.161 0.00167 ** ## age_group46-65 -0.09009 0.03114 -2.893 0.00398 ** ## age_group66 or more -0.17498 0.06199 -2.823 0.00495 ** ## Zone2. URBAN:Religion2. CATHOLIC 0.90298 0.39443 2.289 0.02248 * ## Zone2. URBAN:Religion3. PROTESTANT 0.25355 0.13325 1.903 0.05763 . ## Zone2. URBAN:Religion4. MUSLEM 0.16567 0.12553 1.320 0.18752 ## Zone2. URBAN:ReligionOTHER -0.65549 0.28641 -2.289 0.02252 * ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for gaussian family taken to be 0.7269917) ## ## Number of Fisher Scoring iterations: 2 EXP_model %&gt;% coef() ## (Intercept) Zone2. URBAN ## 6.75103013 0.62235134 ## Religion2. CATHOLIC Religion3. PROTESTANT ## -0.83664621 -0.37824277 ## Religion4. MUSLEM ReligionOTHER ## -0.52808542 -0.27937202 ## Sex2. Female age_group31-45 ## -0.06210920 -0.08358242 ## age_group46-65 age_group66 or more ## -0.09008758 -0.17498242 ## Zone2. URBAN:Religion2. CATHOLIC Zone2. URBAN:Religion3. PROTESTANT ## 0.90298319 0.25355058 ## Zone2. URBAN:Religion4. MUSLEM Zone2. URBAN:ReligionOTHER ## 0.16566844 -0.65548554 Inference on Model Parameters This block extracts the estimated model coefficients along with their 95% confidence intervals and prepares labels for graphical display. LaTeX-style expressions (e.g., \\(\\beta_0, \\beta_1, \\dots\\)) are generated to visually identify each parameter in plots. This formatting enables a clearer and more professional presentation of regression results. #------------------------------------------------------------------------------# # Inference on Model Parameters # #------------------------------------------------------------------------------# # Extract coefficients and confidence intervals coef_df &lt;- tidy(EXP_model, conf.int = TRUE) # Define factor labels for coefficients coef_df$beta &lt;- factor( paste0(&quot;beta[&quot;, 1:nrow(coef_df) -1, &quot;]&quot;), ordered = TRUE, levels = paste0(&quot;beta[&quot;, 1:nrow(coef_df) - 1, &quot;]&quot;), labels = paste0(&quot;beta[&quot;, 1:nrow(coef_df) - 1, &quot;]&quot;) ) # Generate LaTeX-like expressions for beta coefficients beta_labels &lt;- setNames( lapply(0:(nrow(coef_df) - 1), function(i) bquote(beta[.(i)])), paste0(&quot;beta[&quot;, 0:(nrow(coef_df) - 1), &quot;]&quot;) ) This block generates a plot of the survey-weighted linear model coefficients, displaying point estimates with 95% confidence intervals. Each coefficient is labeled using LaTeX-style notation ( \\(\\beta_0, \\beta_1, \\dots\\)*, etc.) on the vertical axis, enhancing clarity and professionalism. A dashed red line at zero provides a reference to identify non-significant effects. # Plot model coefficients with confidence intervals ggplot(coef_df, aes(x = beta, y = estimate)) + geom_point(size = 3, color = &quot;blue&quot;) + # Point estimates geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2, color = &quot;black&quot;) + geom_hline(yintercept = 0, linetype = &quot;dashed&quot;, color = &quot;red&quot;) + # Zero-reference line labs( title = &quot;Survey Model Coefficients&quot;, subtitle = &quot;Point estimates with 95% confidence intervals&quot;, x = &quot;Coefficients&quot;, y = &quot;Estimate&quot; ) + theme_minimal(base_size = 16) + theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5)) + scale_x_discrete(labels = beta_labels) + # Use LaTeX expressions for labels coord_flip() # Flip axes for readability Comparison: Predicted vs Observed Values This block extracts the predicted values from the survey-weighted linear model (EXP_model) and compares them to the observed values of log per capita expenditure. This comparison is essential for assessing model fit and identifying potential systematic deviations between estimated and actual values. #------------------------------------------------------------------------------# # Comparison: Predicted vs Observed Values # #------------------------------------------------------------------------------# # Extract predicted values from the model predicted_values &lt;- predict(EXP_model) %&gt;% data.frame() # Extract observed values from the dataset observed_values &lt;- ESS4_design$variables$log_expenditure This scatter plot compares the observed log per capita expenditure with the values predicted by the model. Each point represents an individual, and the red dashed line indicates perfect prediction (observed = predicted). The closer the points are to this line, the better the model fit. This visualization helps identify systematic bias or patterns of over/underestimation. # Create scatter plot of observed vs predicted values ggplot(data = data.frame(observed = observed_values, predicted = predicted_values[,1]), aes(x = observed, y = predicted)) + geom_point(alpha = 0.5, color = &quot;blue&quot;) + # Scatter plot with transparency geom_abline(intercept = 0, slope = 1, color = &quot;red&quot;, linetype = &quot;dashed&quot;, linewidth = 1.5) + # Reference line labs( title = &quot;Observed vs Predicted Values&quot;, x = &quot;Observed Log Expenditure&quot;, y = &quot;Predicted Log Expenditure&quot; ) + theme_minimal(base_size = 20) + theme(plot.title = element_text(hjust = 0.5)) "]]
